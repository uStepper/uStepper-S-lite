<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>uStepper S-lite: C:/Users/thomasolsen/Documents/Arduino/libraries/uStepper-S-lite/src/uStepperSLite.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">uStepper S-lite
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">uStepperSLite.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="uStepperSLite_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/********************************************************************************************</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">*       File:       uStepperSLite.cpp                                                       *</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">*       Version:    1.1.0                                                                   *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">*       Date:       June 14, 2020                                                           *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">*       Author:     Thomas HÃ¸rring Olsen                                                    *</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">*                                                                                           *   </span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">*********************************************************************************************</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">*                                uStepper S-lite class                                      *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">*   This file contains the implementation of the class methods, incorporated in the         *</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">*   uStepper S-lite arduino library. The library is used by instantiating an uStepper       *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">*   S-lite object by calling either of the two overloaded constructors:                     *</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">*       example:                                                                            *</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">*       uStepperSLite stepper;                                                              *</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">*       OR                                                                                  *</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">*       uStepperSLite stepper(500, 2000);                                                   *</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">*   The first instantiation above creates a uStepper S-lite object with default             *</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">*   acceleration and maximum speed (1000 steps/s^2 and 1000steps/s respectively).           *</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">*   The second instantiation overwrites the default settings of acceleration and            *</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">*   maximum speed (in this case 500 steps/s^2 and 2000 steps/s, respectively);              *</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">*   After instantiation of the object, the object setup function should be called within    *</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">*   Arduino&#39;s setup function:                                                               *</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">*       example:                                                                            *</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">*       uStepperSLite stepper;                                                              *</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">*       void setup()                                                                        *</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">*       {                                                                                   *</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">*           stepper.setup();                                                                *</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">*       }                                                                                   *</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">*       void loop()                                                                         *</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">*       {                                                                                   *</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">*       }                                                                                   *</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">*   After this, the library is ready to control the motor!                                  *</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">*********************************************************************************************</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">*   (C) 2018                                                                                *</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">*   uStepper ApS                                                                            *</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">*   www.ustepper.com                                                                        *</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">*   administration@ustepper.com                                                             *</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">*   The code contained in this file is released under the following open source license:    *</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">*           Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International         *</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">*   The code in this file is provided without warranty of any kind - use at own risk!       *</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">*   neither uStepper ApS nor the author, can be held responsible for any damage             *</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">*   caused by the use of the code contained in this file !                                  *</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">*                                                                                           *</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">********************************************************************************************/</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &lt;uStepperSLite.h&gt;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<a class="code" href="classuStepperSLite.html">uStepperSLite</a> *pointer;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keyword">volatile</span> int32_t *p __attribute__((used));</div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">   75</a></span>&#160;<a class="code" href="classi2cMaster.html">i2cMaster</a> <a class="code" href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">I2C</a>(1);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#af0f7a222eba4eedfcfadafe236757e2f">   78</a></span>&#160;<span class="keywordtype">void</span> INT0_vect(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;{</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordflow">if</span>(PIND &amp; 0x04)</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        PORTD |= (1 &lt;&lt; 4);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        PORTD &amp;= ~(1 &lt;&lt; 4);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span>((PINB &amp; (0x08)))         <span class="comment">//CCW</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">if</span>(!pointer-&gt;<a class="code" href="classuStepperSLite.html#a1d1ce82b808fe8bb9ee71f91e9fae009">invertPidDropinDirection</a>)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a8780cb16590ff36482bb5b3a3392298b">stepCnt</a>--;             <span class="comment">//DIR is set to CCW, therefore we subtract 1 step from step count (negative values = number of steps in CCW direction from initial postion)</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a8780cb16590ff36482bb5b3a3392298b">stepCnt</a>++;         <span class="comment">//DIR is set to CW, therefore we add 1 step to step count (positive values = number of steps in CW direction from initial postion)</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">else</span>                        <span class="comment">//CW</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">if</span>(!pointer-&gt;<a class="code" href="classuStepperSLite.html#a1d1ce82b808fe8bb9ee71f91e9fae009">invertPidDropinDirection</a>)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a8780cb16590ff36482bb5b3a3392298b">stepCnt</a>++;         <span class="comment">//DIR is set to CW, therefore we add 1 step to step count (positive values = number of steps in CW direction from initial postion)</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a8780cb16590ff36482bb5b3a3392298b">stepCnt</a>--;             <span class="comment">//DIR is set to CCW, therefore we subtract 1 step from step count (negative values = number of steps in CCW direction from initial postion)</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="keywordtype">void</span> INT1_vect(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;{</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">if</span>(PIND &amp; 0x04)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        PORTD |= (1 &lt;&lt; 4);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        PORTD &amp;= ~(1 &lt;&lt; 4);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#aca5ebb6cfa63d5fa594d2b5552a72070">  125</a></span>&#160;<span class="keywordtype">void</span> TIMER3_COMPA_vect(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;{</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;push r16 \n\t&quot;</span>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;in r16,0x3F \n\t&quot;</span>);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;push r16 \n\t&quot;</span>);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;push r30 \n\t&quot;</span>);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;push r31 \n\t&quot;</span>);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;lds r30,p \n\t&quot;</span>);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;lds r31,p+1 \n\t&quot;</span>);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;jmp _stepGenerator \n\t&quot;</span>);    <span class="comment">//Execute the acceleration profile algorithm</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;}</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a8bc7a9f474f12ea128e6ea6fde8382a5">  139</a></span>&#160;<span class="keywordtype">void</span> TIMER1_COMPA_vect(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        uint8_t data[2];</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        uint16_t curAngle;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        int16_t deltaAngle;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordtype">float</span> posError = 0.0;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keyword">static</span> <span class="keywordtype">float</span> posEst = 0.0;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keyword">static</span> <span class="keywordtype">float</span> velIntegrator = 0.0;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keyword">static</span> <span class="keywordtype">float</span> velEst = 0.0;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        uint32_t temp;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        int32_t stepCntTemp;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        int32_t pidTargetPositionTruncated;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        int32_t *stepsSinceResetPointer;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordtype">float</span> tempFloat;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        sei();</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">I2C</a>.<a class="code" href="classi2cMaster.html#a20091cd125f847e2cf50d0c7373adaa0">getStatus</a>() != <a class="code" href="i2cMaster_8h.html#a46fd28b671402790a8b9c4c2dde700d8">I2CFREE</a>)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <a class="code" href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">I2C</a>.<a class="code" href="classi2cMaster.html#a9d56b4ea47659456f19cff59ac96d5f9">read</a>(ENCODERADDR, ANGLE, 2, data);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        curAngle = (((uint16_t)data[0]) &lt;&lt; 8 ) | (uint16_t)data[1];</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#ae19871928f7fbe4a1b69270a8cec7932">angle</a> = curAngle;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        curAngle -= pointer-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a602c25ed26a1d3b48ba2215a40b0edd8">encoderOffset</a>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">if</span>(curAngle &gt; 4095)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            curAngle -= 61440;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        deltaAngle = (int16_t)pointer-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a479c3f88c98766f1df30eea67b907c6f">oldAngle</a> - (int16_t)curAngle;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">if</span>(deltaAngle &lt; -2047)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            deltaAngle += 4096;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(deltaAngle &gt; 2047)</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            deltaAngle -= 4096;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a0156342c81b94ab3f7ef176494205f65">angleMoved</a> -= deltaAngle;      <span class="comment">//The AS5600 encoder counts in the opposite direction</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                                        <span class="comment">//as the AEAT8800 (the encoder on uStepper S).</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                                                        <span class="comment">//Therefore it is subtracted here, so the two boards</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                                        <span class="comment">//behave similar</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a479c3f88c98766f1df30eea67b907c6f">oldAngle</a> = curAngle;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> == DROPIN)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            cli();</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                stepCntTemp = pointer-&gt;<a class="code" href="classuStepperSLite.html#a8780cb16590ff36482bb5b3a3392298b">stepCnt</a>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            sei();</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="comment">//      Speed filter</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            posEst += velEst * ENCODERINTSAMPLETIME;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            posError = (float)stepCntTemp - posEst;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            velIntegrator += posError * PULSEFILTERKI;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            velEst = (posError * PULSEFILTERKP) + velIntegrator;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> = velIntegrator;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            posError = (float)stepCntTemp - ((<span class="keywordtype">float</span>)pointer-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a0156342c81b94ab3f7ef176494205f65">angleMoved</a> * pointer-&gt;<a class="code" href="classuStepperSLite.html#a539b0579a291bb4b3c6f4d3680db237f">stepConversion</a>);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a1f52578e510fe01d10bb464d84133395">pidDropin</a>(posError);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">            //      Speed filter</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">            posEst += velEst * ENCODERINTSAMPLETIME;</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">            posError = (float)pointer-&gt;encoder.angleMoved - posEst;</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">            velIntegrator += posError * PULSEFILTERKI;</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">            velEst = (posError * PULSEFILTERKP) + velIntegrator;</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">            pointer-&gt;encoder.curSpeed = velIntegrator * pointer-&gt;stepConversion;</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">            */</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="comment">//stepGenerator speed integrator</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> += pointer-&gt;<a class="code" href="classuStepperSLite.html#ac03777fd1567d5551bea99a78361b5f9">currentPidAcceleration</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a> == CW)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> &gt;= pointer-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                    pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> = pointer-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> &lt; 0.0)</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                    pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> = 0.0;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> &lt;= -pointer-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                    pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> = -pointer-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> &gt; 0.0)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> = 0.0;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="comment">//stepgenerator targetposition integrator</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a> += pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> * ENCODERINTSAMPLETIME;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> == PID)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                pidTargetPositionTruncated = (int32_t)pointer-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                stepsSinceResetPointer = &amp;pidTargetPositionTruncated;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                stepsSinceResetPointer = &amp;pointer-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a22487ca5f5a944459268e29cdb800c2c">continous</a> == 1)</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                pointer-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a> = (float)pointer-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a> &lt; 0)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                    <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a> &lt; (<span class="keywordtype">float</span>)pointer-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a>)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                    {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                        pointer-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a> = (float)pointer-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a>;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                    }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                    <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a> &gt; (<span class="keywordtype">float</span>)pointer-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a>)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                    {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        pointer-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a> = (float)pointer-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                    }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="comment">//acceleration profile generator</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> == INITDECEL)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a> == CCW)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    pointer-&gt;<a class="code" href="classuStepperSLite.html#ac03777fd1567d5551bea99a78361b5f9">currentPidAcceleration</a> = -(pointer-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a> * ENCODERINTSAMPLETIME);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    <span class="keywordflow">if</span>(*stepsSinceResetPointer &gt;= pointer-&gt;<a class="code" href="classuStepperSLite.html#a7720d4c23b591803b56d4610fdf04c1b">decelToAccelThreshold</a>)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                    {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                        pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = ACCEL;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                    }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    pointer-&gt;<a class="code" href="classuStepperSLite.html#ac03777fd1567d5551bea99a78361b5f9">currentPidAcceleration</a> = pointer-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a> * ENCODERINTSAMPLETIME;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                    <span class="keywordflow">if</span>(*stepsSinceResetPointer &lt;= pointer-&gt;decelToAccelThreshold)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                    {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                        pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = ACCEL;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                    }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> == ACCEL)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a> == CCW)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                    <span class="keywordflow">if</span>(*stepsSinceResetPointer &lt;= pointer-&gt;accelToCruiseThreshold)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                    {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                        pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = CRUISE;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                    }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                    pointer-&gt;<a class="code" href="classuStepperSLite.html#ac03777fd1567d5551bea99a78361b5f9">currentPidAcceleration</a> = -(pointer-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a> * ENCODERINTSAMPLETIME);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                    <span class="keywordflow">if</span>(*stepsSinceResetPointer &gt;= pointer-&gt;<a class="code" href="classuStepperSLite.html#a7bd2be0bdf8c9cec85d39b74d6aa4728">accelToCruiseThreshold</a>)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                    {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                        pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = CRUISE;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                    }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                    pointer-&gt;<a class="code" href="classuStepperSLite.html#ac03777fd1567d5551bea99a78361b5f9">currentPidAcceleration</a> = pointer-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a> * ENCODERINTSAMPLETIME;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> == CRUISE)</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            {</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a22487ca5f5a944459268e29cdb800c2c">continous</a> == 1)</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                    pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = CRUISE;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                    <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a> == CCW)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                    {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                        <span class="keywordflow">if</span>(*stepsSinceResetPointer &lt;= pointer-&gt;cruiseToDecelThreshold)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                        {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                            pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = DECEL;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                        }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                    }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                    {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                        <span class="keywordflow">if</span>(*stepsSinceResetPointer &gt;= pointer-&gt;<a class="code" href="classuStepperSLite.html#a807c3fe887eb2ad6c7a099824e2d2b99">cruiseToDecelThreshold</a>)</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                        {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                            pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = DECEL;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                        }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                    }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                pointer-&gt;<a class="code" href="classuStepperSLite.html#ac03777fd1567d5551bea99a78361b5f9">currentPidAcceleration</a> = 0;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> == DECEL)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            {</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a> == CW)</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                    <span class="keywordflow">if</span>(*stepsSinceResetPointer &gt;= pointer-&gt;<a class="code" href="classuStepperSLite.html#ad9e7aea31c689237a0e20650516596e5">decelToStopThreshold</a>)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                    {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                        pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = STOP;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                    }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                    pointer-&gt;<a class="code" href="classuStepperSLite.html#ac03777fd1567d5551bea99a78361b5f9">currentPidAcceleration</a> = -(pointer-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a> * ENCODERINTSAMPLETIME);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                    <span class="keywordflow">if</span>(*stepsSinceResetPointer &lt;= pointer-&gt;decelToStopThreshold)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                    {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                        pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = STOP;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    pointer-&gt;<a class="code" href="classuStepperSLite.html#ac03777fd1567d5551bea99a78361b5f9">currentPidAcceleration</a> = pointer-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a> * ENCODERINTSAMPLETIME;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> == STOP)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                pointer-&gt;<a class="code" href="classuStepperSLite.html#ac03777fd1567d5551bea99a78361b5f9">currentPidAcceleration</a> = 0.0;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> = 0.0;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                TCCR3B &amp;= ~(1 &lt;&lt; CS30);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> == NORMAL)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                    <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a68872d29c8b0dd78742faff9578e320d">brake</a> == BRAKEON)</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                    {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                        PORTD &amp;= ~(1 &lt;&lt; 4);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                    }</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                    {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                        PORTD |= (1 &lt;&lt; 4);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                    }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            }</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> == PID &amp;&amp; !pointer-&gt;<a class="code" href="classuStepperSLite.html#afef8bec3d96458ee9d079df69283d8e3">pidDisabled</a>)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                tempFloat = (float)pointer-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a0156342c81b94ab3f7ef176494205f65">angleMoved</a> * pointer-&gt;<a class="code" href="classuStepperSLite.html#a539b0579a291bb4b3c6f4d3680db237f">stepConversion</a>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                pointer-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a> = (int32_t)(tempFloat);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                pointer-&gt;<a class="code" href="classuStepperSLite.html#aa1acc67d587fdf8b686a0209d5a008c0">pid</a>((<span class="keywordtype">float</span>)pointer-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a> - tempFloat);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> == NORMAL || pointer-&gt;<a class="code" href="classuStepperSLite.html#afef8bec3d96458ee9d079df69283d8e3">pidDisabled</a>)</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> &gt; 5.0)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                    temp = (uint32_t)((STEPGENERATORFREQUENCY/(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>)) + 0.5);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                    cli();</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                        pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = temp;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                    sei();</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> &lt; -5.0)</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                    temp = (uint32_t)((STEPGENERATORFREQUENCY/(-pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>)) + 0.5);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                    cli();</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                        pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = temp;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    sei();</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                    cli();</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                        pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = 20000;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                    sei();</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a833a6e3a84ee1ed1b6a1ec974d59ba2f">detectStall</a>();</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;}</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno"><a class="line" href="classuStepperEncoder.html#ab9c80a99fca938eeb490e4ed8d109f04">  419</a></span>&#160;<a class="code" href="classuStepperEncoder.html#ab9c80a99fca938eeb490e4ed8d109f04">uStepperEncoder::uStepperEncoder</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;{</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <a class="code" href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">I2C</a>.<a class="code" href="classi2cMaster.html#af639b1fb501c7530afdca5e87a56168f">begin</a>();</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;}</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno"><a class="line" href="classuStepperEncoder.html#a29117f4952ff99ba53b90b842f4e69f1">  424</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classuStepperEncoder.html#a29117f4952ff99ba53b90b842f4e69f1">uStepperEncoder::getAngleMoved</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;{</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">return</span> (<span class="keywordtype">float</span>)this-&gt;<a class="code" href="classuStepperEncoder.html#a0156342c81b94ab3f7ef176494205f65">angleMoved</a>*0.087890625;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="classuStepperEncoder.html#a72ec6da0a88627a1abe6380a65b84be4">  429</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classuStepperEncoder.html#a72ec6da0a88627a1abe6380a65b84be4">uStepperEncoder::getSpeed</a>(<span class="keywordtype">bool</span> unit)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;{</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">if</span>(unit == RPM)</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">return</span> this-&gt;<a class="code" href="classuStepperEncoder.html#afe0647659291c6ed4f4104e95f5ae047">curSpeed</a> * pointer-&gt;<a class="code" href="classuStepperSLite.html#a2b91360df7f167a7029770f55b3dcf2d">stepsPerSecondToRPM</a>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">else</span>    <span class="comment">//StepsPerSecond</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">return</span> this-&gt;<a class="code" href="classuStepperEncoder.html#afe0647659291c6ed4f4104e95f5ae047">curSpeed</a>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;}</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno"><a class="line" href="classuStepperEncoder.html#a6d391ceaf50957f3d1ae8736a4c60d76">  441</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperEncoder.html#a6d391ceaf50957f3d1ae8736a4c60d76">uStepperEncoder::setup</a>()</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;{</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    TCNT1 = 0;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    ICR1 = 32000;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    TIFR1 = 0;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    TIMSK1 = (1 &lt;&lt; OCIE1A);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    TCCR1A = (1 &lt;&lt; WGM11);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    TCCR1B = (1 &lt;&lt; WGM12) | (1 &lt;&lt; WGM13) | (1 &lt;&lt; CS10);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;}</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno"><a class="line" href="classuStepperEncoder.html#abf3fc82540c092e8a6c68d4580bedbf9">  451</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperEncoder.html#abf3fc82540c092e8a6c68d4580bedbf9">uStepperEncoder::setHome</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;{</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    cli();</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        uint8_t data[2];</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        TIMSK1 &amp;= ~(1 &lt;&lt; OCIE1A);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <a class="code" href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">I2C</a>.<a class="code" href="classi2cMaster.html#a9d56b4ea47659456f19cff59ac96d5f9">read</a>(ENCODERADDR, ANGLE, 2, data);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        TIMSK1 |= (1 &lt;&lt; OCIE1A);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        this-&gt;<a class="code" href="classuStepperEncoder.html#a602c25ed26a1d3b48ba2215a40b0edd8">encoderOffset</a> = (((uint16_t)data[0]) &lt;&lt; 8 ) | (uint16_t)data[1];</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a> = 0;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        this-&gt;<a class="code" href="classuStepperEncoder.html#ae19871928f7fbe4a1b69270a8cec7932">angle</a> = 0;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        this-&gt;<a class="code" href="classuStepperEncoder.html#a479c3f88c98766f1df30eea67b907c6f">oldAngle</a> = 0;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        this-&gt;<a class="code" href="classuStepperEncoder.html#a0156342c81b94ab3f7ef176494205f65">angleMoved</a> = 0;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a> = 0.0;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a> = 0;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#a0383041fd93699cb06f857e8680ddf73">pidError</a> = 0;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    sei();</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;}</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160; </div>
<div class="line"><a name="l00469"></a><span class="lineno"><a class="line" href="classuStepperEncoder.html#abf760d7949e75977bf11bce48256283c">  469</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classuStepperEncoder.html#abf760d7949e75977bf11bce48256283c">uStepperEncoder::getAngle</a>()</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;{</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">return</span> (<span class="keywordtype">float</span>)this-&gt;<a class="code" href="classuStepperEncoder.html#ae19871928f7fbe4a1b69270a8cec7932">angle</a>*0.087890625;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno"><a class="line" href="classuStepperEncoder.html#a26b81725b7a995fed98de0fcdd614b1f">  474</a></span>&#160;uint16_t <a class="code" href="classuStepperEncoder.html#a26b81725b7a995fed98de0fcdd614b1f">uStepperEncoder::getStrength</a>()</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;{</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    uint8_t data[2];</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    TIMSK1 &amp;= ~(1 &lt;&lt; OCIE1A);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">I2C</a>.<a class="code" href="classi2cMaster.html#a9d56b4ea47659456f19cff59ac96d5f9">read</a>(ENCODERADDR, MAGNITUDE, 2, data);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    TIMSK1 |= (1 &lt;&lt; OCIE1A);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">return</span> (((uint16_t)data[0]) &lt;&lt; 8 )| (uint16_t)data[1];</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;}</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno"><a class="line" href="classuStepperEncoder.html#a8a4a9e8dab1412c67de52b4454050d3e">  485</a></span>&#160;uint8_t <a class="code" href="classuStepperEncoder.html#a8a4a9e8dab1412c67de52b4454050d3e">uStepperEncoder::getAgc</a>()</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;{</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    uint8_t data;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    TIMSK1 &amp;= ~(1 &lt;&lt; OCIE1A);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <a class="code" href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">I2C</a>.<a class="code" href="classi2cMaster.html#a9d56b4ea47659456f19cff59ac96d5f9">read</a>(ENCODERADDR, AGC, 1, &amp;data);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    TIMSK1 |= (1 &lt;&lt; OCIE1A);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">return</span> data;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;}</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno"><a class="line" href="classuStepperEncoder.html#a990203acc3069947412e0a9dd36bc988">  494</a></span>&#160;uint8_t <a class="code" href="classuStepperEncoder.html#a990203acc3069947412e0a9dd36bc988">uStepperEncoder::detectMagnet</a>()</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;{</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    uint8_t data;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    TIMSK1 &amp;= ~(1 &lt;&lt; OCIE1A);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">I2C</a>.<a class="code" href="classi2cMaster.html#a9d56b4ea47659456f19cff59ac96d5f9">read</a>(ENCODERADDR, STATUS, 1, &amp;data);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    TIMSK1 |= (1 &lt;&lt; OCIE1A);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    data &amp;= 0x38;                   <span class="comment">//For some reason the encoder returns random values on reserved bits. Therefore we make sure reserved bits are cleared before checking the reply !</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">if</span>(data == 0x08)</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="keywordflow">return</span> 1;                   <span class="comment">//magnet too strong</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(data == 0x10)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">return</span> 2;                   <span class="comment">//magnet too weak</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(data == 0x20)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordflow">return</span> 0;                   <span class="comment">//magnet detected and within limits</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160; </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">return</span> 3;                       <span class="comment">//Something went horribly wrong !</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;}</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#aa8dc00944af9823735619ede4e114439">  520</a></span>&#160;<a class="code" href="classuStepperSLite.html#aa8dc00944af9823735619ede4e114439">uStepperSLite::uStepperSLite</a>(<span class="keywordtype">float</span> accel, <span class="keywordtype">float</span> vel)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;{</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = STOP;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a1eb46f8626f7ddd7e4f7f8d301fced50">setMaxVelocity</a>(vel);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a936581f459eb80191ad1fd7feb092c08">setMaxAcceleration</a>(accel);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    pointer = <span class="keyword">this</span>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    DDRB |= (1 &lt;&lt; 2);       <span class="comment">//set direction pin to output</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    DDRD |= (1 &lt;&lt; 7);       <span class="comment">//set step pin to output</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    DDRD |= (1 &lt;&lt; 4);       <span class="comment">//set enable pin to output</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;}</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160; </div>
<div class="line"><a name="l00534"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a936581f459eb80191ad1fd7feb092c08">  534</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a936581f459eb80191ad1fd7feb092c08">uStepperSLite::setMaxAcceleration</a>(<span class="keywordtype">float</span> accel)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;{</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a> = accel;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> != STOP)</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    {</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a22487ca5f5a944459268e29cdb800c2c">continous</a> == 1)    <span class="comment">//If motor was running continously</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#ab5bf3cf124d2d52fc06ce97c7651b081">runContinous</a>(this-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a>);    <span class="comment">//We should make it run continously again</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordflow">else</span>                        <span class="comment">//If motor still needs to perform some steps</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a1b876adeb71ec6f0f03dba8bb88df30c">moveSteps</a>(abs(this-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a> - this-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a> + 1), this-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a>, this-&gt;<a class="code" href="classuStepperSLite.html#a68872d29c8b0dd78742faff9578e320d">brake</a>);   <span class="comment">//we should make sure the motor gets to execute the remaining steps</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;}</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a1eb46f8626f7ddd7e4f7f8d301fced50">  551</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a1eb46f8626f7ddd7e4f7f8d301fced50">uStepperSLite::setMaxVelocity</a>(<span class="keywordtype">float</span> vel)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;{</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">if</span>(vel &lt; 0.5005)</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a> = 0.5005;            <span class="comment">//Limit velocity in order to not overflow delay variable</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(vel &gt; 100000.0)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a> = 100000.0;          <span class="comment">//limit velocity in order to not underflow delay variable</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a> = vel;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160; </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> != STOP)     <span class="comment">//If motor was running, we should make sure it runs again</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a22487ca5f5a944459268e29cdb800c2c">continous</a> == 1)    <span class="comment">//If motor was running continously</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#ab5bf3cf124d2d52fc06ce97c7651b081">runContinous</a>(this-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a>);    <span class="comment">//We should make it run continously again</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">else</span>                    <span class="comment">//If motor still needs to perform some steps</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a1b876adeb71ec6f0f03dba8bb88df30c">moveSteps</a>(abs(this-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a> - this-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a> + 1), this-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a>, this-&gt;<a class="code" href="classuStepperSLite.html#a68872d29c8b0dd78742faff9578e320d">brake</a>);   <span class="comment">//we should make sure the motor gets to execute the remaining steps</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;}</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#ab5bf3cf124d2d52fc06ce97c7651b081">  584</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#ab5bf3cf124d2d52fc06ce97c7651b081">uStepperSLite::runContinous</a>(<span class="keywordtype">bool</span> dir)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;{</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordtype">float</span> curVel, startVelocity = 0;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    uint8_t tempState;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    uint32_t accelSteps;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    uint32_t initialDecelSteps;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160; </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> == DROPIN)</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    {</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="keywordflow">return</span>;     <span class="comment">//Drop in feature is activated. just return since this function makes no sense with drop in activated!</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    curVel = this-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> == STOP)                                         <span class="comment">//If motor is currently running at desired speed</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        initialDecelSteps = 0;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        tempState = ACCEL;                      <span class="comment">//We should just run at cruise speed</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        startVelocity = 0.0;<span class="comment">//sqrt(2.0*this-&gt;acceleration); //number of interrupts before the first step should be performed.</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        accelSteps = (uint32_t)((this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a> * this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));    <span class="comment">//Number of steps to bring the motor to max speed (S = (V^2 - V0^2)/(2*a)))</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((dir == CW &amp;&amp; curVel &lt; 0) || (dir == CCW &amp;&amp; curVel &gt; 0))                                    <span class="comment">//If motor turns CCW and should turn CW, or if motor turns CW and shoÃºld turn CCW</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        tempState = INITDECEL;                                  <span class="comment">//We should decelerate the motor to full stop</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        initialDecelSteps = (uint32_t)((curVel*curVel)/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));       <span class="comment">//the amount of steps needed to bring the motor to full stop. (S = (V^2 - V0^2)/(2*-a)))</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        accelSteps = (uint32_t)((this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a> * this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));                                    <span class="comment">//Number of steps to bring the motor to max speed (S = (V^2 - V0^2)/(2*a)))</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        startVelocity = curVel;<span class="comment">//sqrt((curVel*curVel) + 2.0*this-&gt;acceleration);    //number of interrupts before the first step should be performed.</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((dir == CW &amp;&amp; curVel &gt; 0) || (dir == CCW &amp;&amp; curVel &lt; 0))                                                <span class="comment">//If the motor is currently rotating the same direction as the desired direction</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="keywordflow">if</span>(abs(curVel) &gt; this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)                        <span class="comment">//If current velocity is greater than desired velocity</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            tempState = INITDECEL;                      <span class="comment">//We need to decelerate the motor to desired velocity</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            initialDecelSteps = (uint32_t)(((this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>*this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>) - (curVel*curVel))/(-2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));      <span class="comment">//Number of steps to bring the motor down from current speed to max speed (S = (V^2 - V0^2)/(2*-a)))</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            accelSteps = 0;                     <span class="comment">//No acceleration phase is needed</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(abs(curVel) &lt; this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)                   <span class="comment">//If the current velocity is less than the desired velocity</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            tempState = ACCEL;                          <span class="comment">//Start accelerating</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            accelSteps = (uint32_t)(((this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>*this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>) - (curVel*curVel))/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));  <span class="comment">//Number of Steps needed to accelerate from current velocity to full speed</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            initialDecelSteps = 0;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">else</span>                                            <span class="comment">//If motor is currently running at desired speed</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            initialDecelSteps = 0;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            tempState = CRUISE;                     <span class="comment">//We should just run at cruise speed</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            accelSteps = 0;                     <span class="comment">//No acceleration phase is needed</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        }</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    {</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        initialDecelSteps = 0;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        tempState = ACCEL;                      <span class="comment">//We should just run at cruise speed</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        startVelocity = 0.0;<span class="comment">//sqrt(2.0*this-&gt;acceleration); //number of interrupts before the first step should be performed.</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        accelSteps = (uint32_t)((this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a> * this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));    <span class="comment">//Number of steps to bring the motor to max speed (S = (V^2 - V0^2)/(2*a)))</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    }</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    cli();</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a> = dir;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#aaf8a4bd9baac5f7370a33bbf439983ad">stepGeneratorDirection</a> = dir;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a22487ca5f5a944459268e29cdb800c2c">continous</a> = 1;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keywordflow">if</span>(dir == CW)</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        {</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a7720d4c23b591803b56d4610fdf04c1b">decelToAccelThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a> + initialDecelSteps;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a7bd2be0bdf8c9cec85d39b74d6aa4728">accelToCruiseThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a7720d4c23b591803b56d4610fdf04c1b">decelToAccelThreshold</a> + accelSteps;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            PORTB |= (1 &lt;&lt; 2);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        {</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a7720d4c23b591803b56d4610fdf04c1b">decelToAccelThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a> - initialDecelSteps;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a7bd2be0bdf8c9cec85d39b74d6aa4728">accelToCruiseThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a7720d4c23b591803b56d4610fdf04c1b">decelToAccelThreshold</a> - accelSteps;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            PORTB &amp;= ~(1 &lt;&lt; 2);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> = startVelocity;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> &gt; 5.0)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = (uint32_t)((STEPGENERATORFREQUENCY/(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>)) + 0.5);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        }</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> &lt; -5.0)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = (uint32_t)((STEPGENERATORFREQUENCY/(-pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>)) + 0.5);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        }</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = 20000;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = tempState;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    sei();</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    PORTD &amp;= ~(1 &lt;&lt; 4);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    TCCR3B |= (1 &lt;&lt; CS30);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;}</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a1b876adeb71ec6f0f03dba8bb88df30c">  682</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a1b876adeb71ec6f0f03dba8bb88df30c">uStepperSLite::moveSteps</a>(int32_t steps, <span class="keywordtype">bool</span> dir, <span class="keywordtype">bool</span> holdMode)</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;{</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordtype">float</span> curVel, startVelocity = 0;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    uint8_t <a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a>;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    uint32_t totalSteps;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    uint32_t accelSteps;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    uint32_t decelSteps;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    uint32_t initialDecelSteps;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    uint32_t cruiseSteps = 0;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160; </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> == DROPIN)</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <span class="keywordflow">return</span>;     <span class="comment">//Drop in feature is activated. just return since this function makes no sense with drop in activated!</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">if</span>(steps &lt; 1)</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    {</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="comment">//steps--;</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    totalSteps = steps;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    cli();</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        curVel = this-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    sei();</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    initialDecelSteps = 0;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordflow">if</span>(this-&gt;state == STOP)                             <span class="comment">//If motor is currently at full stop (state = STOP)</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = ACCEL;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        accelSteps = (uint32_t)((this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a> * this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));    <span class="comment">//Number of steps to bring the motor to max speed (S = (V^2 - V0^2)/(2*a)))</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                <span class="comment">//No initial deceleration phase needed</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordflow">if</span>(accelSteps &gt; (totalSteps &gt;&gt; 1))  <span class="comment">//If we need to accelerate for longer than half of the total steps, we need to start decelerating before we reach max speed</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            cruiseSteps = 0;        <span class="comment">//No cruise phase needed</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            accelSteps = decelSteps = (totalSteps &gt;&gt; 1);                <span class="comment">//Accelerate and decelerate for the same amount of steps (half the total steps)</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            accelSteps += totalSteps - accelSteps - decelSteps; <span class="comment">//if there are still a step left to perform, due to rounding errors, do this step as an acceleration step</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        }</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            decelSteps = accelSteps;    <span class="comment">//If top speed is reached before half the total steps are performed, deceleration period should be same length as acceleration period</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            cruiseSteps = totalSteps - accelSteps - decelSteps; <span class="comment">//Perform remaining steps as cruise steps</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        startVelocity = 0.0;<span class="comment">//sqrt(2.0*this-&gt;acceleration); //number of interrupts before the first step should be performed.</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    }</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((dir == CW &amp;&amp; curVel &lt; 0) || (dir == CCW &amp;&amp; curVel &gt; 0))                                    <span class="comment">//If motor turns CCW and should turn CW, or if motor turns CW and shoÃºld turn CCW</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = INITDECEL;                                  <span class="comment">//We should decelerate the motor to full stop</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        initialDecelSteps = (uint32_t)((curVel*curVel)/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));       <span class="comment">//the amount of steps needed to bring the motor to full stop. (S = (V^2 - V0^2)/(2*-a)))</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        accelSteps = (uint32_t)((this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a> * this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));                                    <span class="comment">//Number of steps to bring the motor to max speed (S = (V^2 - V0^2)/(2*a)))</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        totalSteps += initialDecelSteps;                <span class="comment">//Add the steps used for initial deceleration to the totalSteps variable, since we moved this number of steps, passed the initial position, and therefore need to move this amount of steps extra, in the desired direction</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160; </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="keywordflow">if</span>(accelSteps &gt; (totalSteps &gt;&gt; 1))          <span class="comment">//If we need to accelerate for longer than half of the total steps, we need to start decelerating before we reach max speed</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            accelSteps = decelSteps = (totalSteps &gt;&gt; 1);    <span class="comment">//Accelerate and decelerate for the same amount of steps (half the total steps)</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            accelSteps += totalSteps - accelSteps - decelSteps;             <span class="comment">//If there are still a step left to perform, due to rounding errors, do this step as an acceleration step</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            cruiseSteps = 0;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            decelSteps = accelSteps;                    <span class="comment">//If top speed is reached before half the total steps are performed, deceleration period should be same length as acceleration period</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            cruiseSteps = totalSteps - accelSteps - decelSteps;             <span class="comment">//Perform remaining steps, as cruise steps</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        }</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        startVelocity = curVel; <span class="comment">//sqrt((curVel*curVel) + 2.0*this-&gt;acceleration);   //number of interrupts before the first step should be performed.</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((dir == CW &amp;&amp; curVel &gt; 0) || (dir == CCW &amp;&amp; curVel &lt; 0))                            <span class="comment">//If the motor is currently rotating the same direction as desired, we dont necessarily need to decelerate</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    {</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">if</span>(abs(curVel) &gt; this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)    <span class="comment">//If current velocity is greater than desired velocity</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            state = INITDECEL;  <span class="comment">//We need to decelerate the motor to desired velocity</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            initialDecelSteps = (uint32_t)(((this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>*this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>) - (curVel*curVel))/(-2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));      <span class="comment">//Number of steps to bring the motor down from current speed to max speed (S = (V^2 - V0^2)/(2*-a)))</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            accelSteps = 0; <span class="comment">//No acceleration phase is needed</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            decelSteps = (uint32_t)((this-&gt;velocity*this-&gt;velocity)/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));  <span class="comment">//Number of steps needed to decelerate the motor from top speed to full stop</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            startVelocity = curVel;<span class="comment">//sqrt((curVel*curVel) + (2.0*this-&gt;acceleration));</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <span class="keywordflow">if</span>(totalSteps &lt;= (initialDecelSteps + decelSteps))</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                cruiseSteps = 0;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            {</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                cruiseSteps = steps - initialDecelSteps - decelSteps;                   <span class="comment">//Perform remaining steps as cruise steps</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            }</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        }</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160; </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(abs(curVel) &lt; this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)   <span class="comment">//If current velocity is less than desired velocity</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        {</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            state = ACCEL;          <span class="comment">//Start accelerating</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            accelSteps = (int32_t)((((this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>*this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>) - curVel*curVel))/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));   <span class="comment">//Number of Steps needed to accelerate from current velocity to full speed</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            <span class="keywordflow">if</span>(accelSteps &gt; (totalSteps &gt;&gt; 1))          <span class="comment">//If we need to accelerate for longer than half of the total steps, we need to start decelerating before we reach max speed</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                accelSteps = decelSteps = (totalSteps &gt;&gt; 1);    <span class="comment">//Accelerate and decelerate for the same amount of steps (half the total steps)</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                accelSteps += totalSteps - accelSteps - decelSteps;             <span class="comment">//If there are still a step left to perform, due to rounding errors, do this step as an acceleration step</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                cruiseSteps = 0;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            {</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                decelSteps = accelSteps;                    <span class="comment">//If top speed is reached before half the total steps are performed, deceleration period should be same length as acceleration period</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                cruiseSteps = totalSteps - accelSteps - decelSteps;             <span class="comment">//Perform remaining steps, as cruise steps</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            cruiseSteps = totalSteps - accelSteps - decelSteps; <span class="comment">//Perform remaining steps as cruise steps</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            initialDecelSteps = 0;                              <span class="comment">//No initial deceleration phase needed</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="keywordflow">else</span>                        <span class="comment">//If current velocity is equal to desired velocity</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            <a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = CRUISE; <span class="comment">//We are already at desired speed, therefore we start at cruise phase</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            decelSteps = (int32_t)((this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>*this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));   <span class="comment">//Number of steps needed to decelerate the motor from top speed to full stop</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            accelSteps = 0; <span class="comment">//No acceleration phase needed</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            initialDecelSteps = 0;      <span class="comment">//No initial deceleration phase needed</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            <span class="keywordflow">if</span>(decelSteps &gt;= totalSteps)</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                cruiseSteps = 0;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                decelSteps = totalSteps;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            }</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                cruiseSteps = totalSteps - decelSteps;  <span class="comment">//Perform remaining steps as cruise steps</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        startVelocity = curVel;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    }</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = ACCEL;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        accelSteps = (uint32_t)((this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a> * this-&gt;<a class="code" href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">velocity</a>)/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));    <span class="comment">//Number of steps to bring the motor to max speed (S = (V^2 - V0^2)/(2*a)))</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                <span class="comment">//No initial deceleration phase needed</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">if</span>(accelSteps &gt; (totalSteps &gt;&gt; 1))  <span class="comment">//If we need to accelerate for longer than half of the total steps, we need to start decelerating before we reach max speed</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        {</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            cruiseSteps = 0;        <span class="comment">//No cruise phase needed</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            accelSteps = decelSteps = (totalSteps &gt;&gt; 1);                <span class="comment">//Accelerate and decelerate for the same amount of steps (half the total steps)</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            accelSteps += totalSteps - accelSteps - decelSteps; <span class="comment">//if there are still a step left to perform, due to rounding errors, do this step as an acceleration step</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        }</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160; </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            decelSteps = accelSteps;    <span class="comment">//If top speed is reached before half the total steps are performed, deceleration period should be same length as acceleration period</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            cruiseSteps = totalSteps - accelSteps - decelSteps; <span class="comment">//Perform remaining steps as cruise steps</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        startVelocity = 0.0;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    cli();</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a> = dir;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#aaf8a4bd9baac5f7370a33bbf439983ad">stepGeneratorDirection</a> = dir;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160; </div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a22487ca5f5a944459268e29cdb800c2c">continous</a> = 0;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keywordflow">if</span>(dir == CW)</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        {</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a7720d4c23b591803b56d4610fdf04c1b">decelToAccelThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a> + initialDecelSteps;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a7bd2be0bdf8c9cec85d39b74d6aa4728">accelToCruiseThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a7720d4c23b591803b56d4610fdf04c1b">decelToAccelThreshold</a> + accelSteps;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a807c3fe887eb2ad6c7a099824e2d2b99">cruiseToDecelThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a7bd2be0bdf8c9cec85d39b74d6aa4728">accelToCruiseThreshold</a> + cruiseSteps;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#ad9e7aea31c689237a0e20650516596e5">decelToStopThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a807c3fe887eb2ad6c7a099824e2d2b99">cruiseToDecelThreshold</a> + decelSteps;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            PORTB |= (1 &lt;&lt; 2);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a7720d4c23b591803b56d4610fdf04c1b">decelToAccelThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a> - initialDecelSteps;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a7bd2be0bdf8c9cec85d39b74d6aa4728">accelToCruiseThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a7720d4c23b591803b56d4610fdf04c1b">decelToAccelThreshold</a> - accelSteps;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a807c3fe887eb2ad6c7a099824e2d2b99">cruiseToDecelThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a7bd2be0bdf8c9cec85d39b74d6aa4728">accelToCruiseThreshold</a> - cruiseSteps;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#ad9e7aea31c689237a0e20650516596e5">decelToStopThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a807c3fe887eb2ad6c7a099824e2d2b99">cruiseToDecelThreshold</a> - decelSteps;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            PORTB &amp;= ~(1 &lt;&lt; 2);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> = startVelocity;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> &gt; 5.0)</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        {</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = (uint32_t)((STEPGENERATORFREQUENCY/(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>)) + 0.5);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> &lt; -5.0)</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        {</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = (uint32_t)((STEPGENERATORFREQUENCY/(-pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>)) + 0.5);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        }</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        {</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = 20000;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        this-&gt;state = <a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a>;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a> = this-&gt;<a class="code" href="classuStepperSLite.html#ad9e7aea31c689237a0e20650516596e5">decelToStopThreshold</a>;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a68872d29c8b0dd78742faff9578e320d">brake</a> = holdMode;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    sei();</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    PORTD &amp;= ~(1 &lt;&lt; 4);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    TCCR3B |= (1 &lt;&lt; CS30);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;}</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; </div>
<div class="line"><a name="l00873"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a09da30650e441262d015907686107799">  873</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a09da30650e441262d015907686107799">uStepperSLite::hardStop</a>(<span class="keywordtype">bool</span> holdMode)</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;{</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> == DROPIN)</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    {</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        <span class="keywordflow">return</span>;     <span class="comment">//Drop in feature is activated. just return since this function makes no sense with drop in activated!</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    cli();</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a> = (int32_t)((<span class="keywordtype">float</span>)this-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a0156342c81b94ab3f7ef176494205f65">angleMoved</a> * this-&gt;<a class="code" href="classuStepperSLite.html#a539b0579a291bb4b3c6f4d3680db237f">stepConversion</a>);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a>;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a>;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#ad9e7aea31c689237a0e20650516596e5">decelToStopThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a>;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160; </div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = DECEL;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a68872d29c8b0dd78742faff9578e320d">brake</a> = holdMode;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a22487ca5f5a944459268e29cdb800c2c">continous</a> = 0;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = 2;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    sei();</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    PORTD &amp;= ~(1 &lt;&lt; 4);</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    TCCR3B |= (1 &lt;&lt; CS30);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;}</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00898"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#ae0833b2d44aeb4987cbf3ce734911185">  898</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#ae0833b2d44aeb4987cbf3ce734911185">uStepperSLite::stop</a>(<span class="keywordtype">bool</span> brake)</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;{</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a3d1c21d80071e805998750ea55e7b8f9">softStop</a>(brake);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;}</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a3d1c21d80071e805998750ea55e7b8f9">  903</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a3d1c21d80071e805998750ea55e7b8f9">uStepperSLite::softStop</a>(<span class="keywordtype">bool</span> holdMode)</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;{</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    uint32_t decelSteps = 0;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keywordtype">float</span> curVel = 0.0;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> == DROPIN)</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    {</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordflow">return</span>;     <span class="comment">//Drop in feature is activated. just return since this function makes no sense with drop in activated!</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    }</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    cli();</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    curVel = this-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    decelSteps = (uint32_t)((curVel*curVel)/(2.0*this-&gt;<a class="code" href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">acceleration</a>));</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a> == CW)</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a> + decelSteps;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#ad9e7aea31c689237a0e20650516596e5">decelToStopThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a>;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    }</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a> - decelSteps;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#ad9e7aea31c689237a0e20650516596e5">decelToStopThreshold</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a>;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = DECEL;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a68872d29c8b0dd78742faff9578e320d">brake</a> = holdMode;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a22487ca5f5a944459268e29cdb800c2c">continous</a> = 0;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> = curVel;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> &gt; 5.0)</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    {</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = (uint32_t)((STEPGENERATORFREQUENCY/(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>)) + 0.5);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    }</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a> &lt; -5.0)</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    {</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = (uint32_t)((STEPGENERATORFREQUENCY/(-pointer-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>)) + 0.5);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = 20000;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    }</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    sei();</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    PORTD &amp;= ~(1 &lt;&lt; 4);</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    TCCR3B |= (1 &lt;&lt; CS30);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;}</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a2c225c30565d8afc6472db1682ec0f78">  949</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a2c225c30565d8afc6472db1682ec0f78">uStepperSLite::checkConnectorOrientation</a>(uint8_t mode)</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;{</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    uint8_t data[2], i;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    uint16_t <a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    int16_t angleDiff[3];</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <a class="code" href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">I2C</a>.<a class="code" href="classi2cMaster.html#a9d56b4ea47659456f19cff59ac96d5f9">read</a>(ENCODERADDR, ANGLE, 2, data);</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a> = (((uint16_t)data[0]) &lt;&lt; 8 ) | (uint16_t)data[1];</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160; </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    PORTB &amp;= ~(1 &lt;&lt; 2);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; 50; i++)</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        PORTD |= (1 &lt;&lt; 7);</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        delayMicroseconds(1);</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        PORTD &amp;= ~(1 &lt;&lt; 7);</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        _delay_ms(10);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    }</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160; </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    angleDiff[0] = (int16_t)<a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a>;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160; </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <a class="code" href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">I2C</a>.<a class="code" href="classi2cMaster.html#a9d56b4ea47659456f19cff59ac96d5f9">read</a>(ENCODERADDR, ANGLE, 2, data);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a> = (((uint16_t)data[0]) &lt;&lt; 8 ) | (uint16_t)data[1];</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160; </div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    angleDiff[0] -= (int16_t)<a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a>;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    PORTB |= (1 &lt;&lt; 2);</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; 50; i++)</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    {</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        PORTD |= (1 &lt;&lt; 7);</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        delayMicroseconds(1);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        PORTD &amp;= ~(1 &lt;&lt; 7);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        _delay_ms(10);</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    }</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    angleDiff[1] = (int16_t)<a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160; </div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <a class="code" href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">I2C</a>.<a class="code" href="classi2cMaster.html#a9d56b4ea47659456f19cff59ac96d5f9">read</a>(ENCODERADDR, ANGLE, 2, data);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a> = (((uint16_t)data[0]) &lt;&lt; 8 ) | (uint16_t)data[1];</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160; </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    angleDiff[1] -= (int16_t)<a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; 2; i++)</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    {</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        <span class="keywordflow">if</span>(angleDiff[i] &gt; 2048)</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        {</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            angleDiff[i] -= 4096;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(angleDiff[i] &lt; -2048)</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            angleDiff[i] += 4096;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        }</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    }</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160; </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keywordflow">if</span>((angleDiff[0] &gt; 2 &amp;&amp; angleDiff[1] &lt; -2))</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    {</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> == DROPIN)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        {</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.<a class="code" href="classTmc2208.html#a1576b8921751c68fff4a161453c99223">invertDirection</a>();</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        }</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    {</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keywordflow">if</span>(mode != DROPIN)</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        {</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.<a class="code" href="classTmc2208.html#a1576b8921751c68fff4a161453c99223">invertDirection</a>();</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        }</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    }</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;}</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; </div>
<div class="line"><a name="l01020"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a522818baa29b655181ab43d6ece90cff"> 1020</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a522818baa29b655181ab43d6ece90cff">uStepperSLite::setup</a>(  uint8_t mode = NORMAL, </div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                <span class="keywordtype">float</span> stepsPerRevolution = 3200.0, </div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                <span class="keywordtype">float</span> pTerm = 0.75, </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                <span class="keywordtype">float</span> iTerm = 3.0, </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                <span class="keywordtype">float</span> dTerm = 0.0,</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                <span class="keywordtype">bool</span> setHome = <span class="keyword">true</span>,</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                uint8_t invert,</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                uint8_t runCurrent,</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                uint8_t holdCurrent)</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;{</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <a class="code" href="structdropinCliSettings__t.html">dropinCliSettings_t</a> tempSettings;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160; </div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    p = &amp;(this-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a>);</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#afef8bec3d96458ee9d079df69283d8e3">pidDisabled</a> = 1;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> = <a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a>;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a6d391ceaf50957f3d1ae8736a4c60d76">setup</a>();</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160; </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = STOP;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.<a class="code" href="classTmc2208.html#a325a92257b38336e9ef6df12fcd4d552">setup</a>();</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.<a class="code" href="classTmc2208.html#a648e00eda3d756b154a7d62572d5c12d">enableDriver</a>();</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    _delay_ms(200);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160; </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordflow">if</span>((uint16_t)stepsPerRevolution == FULL)</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    {</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        stepsPerRevolution = 200.0;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    }</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((uint16_t)stepsPerRevolution == HALF)</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    {</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        stepsPerRevolution = 400.0;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    }</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((uint16_t)stepsPerRevolution == QUARTER)</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    {</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        stepsPerRevolution = 800.0;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    }</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((uint16_t)stepsPerRevolution == EIGHT)</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    {</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        stepsPerRevolution = 1600.0;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    }</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((uint16_t)stepsPerRevolution == SIXTEEN)</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    {</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        stepsPerRevolution = 3200.0;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    }</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160; </div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a539b0579a291bb4b3c6f4d3680db237f">stepConversion</a> = (float)(stepsPerRevolution)/4096.0;  <span class="comment">//Calculate conversion coefficient from raw encoder data, to actual moved steps</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#afd5ccf623308a2f47af9b58ff2e16023">angleToStep</a> = ((float)(stepsPerRevolution))/360.0;    <span class="comment">//Calculate conversion coefficient from angle to corresponding number of steps</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#ab6b5281894496ce93b304f8af3ef812c">stepToAngle</a> = 360.0/((float)(stepsPerRevolution));    <span class="comment">//Calculate conversion coefficient from steps to corresponding angle</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a2b91360df7f167a7029770f55b3dcf2d">stepsPerSecondToRPM</a> = 60.0/stepsPerRevolution;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#ab46a2701ac9bee37e0f598a2f5306158">RPMToStepsPerSecond</a> = stepsPerRevolution/60.0;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a12aadc19a70c86840ffb8ae4fc52d757">RPMToStepDelay</a> = STEPGENERATORFREQUENCY/this-&gt;<a class="code" href="classuStepperSLite.html#ab46a2701ac9bee37e0f598a2f5306158">RPMToStepsPerSecond</a>;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#abf3fc82540c092e8a6c68d4580bedbf9">setHome</a>();</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a>)</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    {</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> == DROPIN)</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            <span class="comment">//Set Enable, Step and Dir signal pins from 3dPrinter controller as inputs</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            pinMode(2,INPUT);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            pinMode(3,INPUT);</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            pinMode(4,INPUT);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <span class="comment">//Enable internal pull-up resistors on the above pins</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            digitalWrite(2,HIGH);</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            digitalWrite(3,HIGH);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            digitalWrite(4,HIGH);</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            EICRA = 0x06;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            EIMSK = 0x03;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            Serial.begin(9600);</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160; </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            tempSettings.<a class="code" href="structdropinCliSettings__t.html#ac2ae5becda6e7d44075f51d81acc0147">P</a>.<a class="code" href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">f</a> = <a class="code" href="classuStepperSLite.html#afd708364388d62b61f32755868540e59">pTerm</a>;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            tempSettings.<a class="code" href="structdropinCliSettings__t.html#aa3341deb156fc6151de8794e43459732">I</a>.<a class="code" href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">f</a> = <a class="code" href="classuStepperSLite.html#a157fb9075d4c6c451a7f8e43367df27a">iTerm</a>;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            tempSettings.<a class="code" href="structdropinCliSettings__t.html#a00ded376c02dfc7d764f07d4ed8b47fd">D</a>.<a class="code" href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">f</a> = <a class="code" href="classuStepperSLite.html#a5324ae9b6cfbb63a1b82433c7c2b77a1">dTerm</a>;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            tempSettings.<a class="code" href="structdropinCliSettings__t.html#a5746cba668768ac204a54751bc932271">invert</a> = invert;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            tempSettings.<a class="code" href="structdropinCliSettings__t.html#ac36b9ae1990fb507c66fda2bacee5bf9">runCurrent</a> = runCurrent;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            tempSettings.<a class="code" href="structdropinCliSettings__t.html#a447e69fba3c710086e68b7659bd919d7">holdCurrent</a> = holdCurrent;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            tempSettings.<a class="code" href="structdropinCliSettings__t.html#ab360463f25b89cd8192d284a6024c237">checksum</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a7cdcebc3e378c9aa5a849e75616bfb81">dropinSettingsCalcChecksum</a>(&amp;tempSettings);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            <span class="keywordflow">if</span>(tempSettings.<a class="code" href="structdropinCliSettings__t.html#ab360463f25b89cd8192d284a6024c237">checksum</a> != EEPROM.read(<span class="keyword">sizeof</span>(<a class="code" href="structdropinCliSettings__t.html">dropinCliSettings_t</a>)))</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            {</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a> = tempSettings;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                this-&gt;<a class="code" href="classuStepperSLite.html#a4bad2987e56031e2bf18b4bb49641312">saveDropinSettings</a>();</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                EEPROM.put(<span class="keyword">sizeof</span>(<a class="code" href="structdropinCliSettings__t.html">dropinCliSettings_t</a>),this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#ab360463f25b89cd8192d284a6024c237">checksum</a>);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                this-&gt;<a class="code" href="classuStepperSLite.html#ada5b6ce856fea6afe4d7491da3fe8677">loadDropinSettings</a>();</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;            }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;            {</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                <span class="keywordflow">if</span>(!this-&gt;<a class="code" href="classuStepperSLite.html#ada5b6ce856fea6afe4d7491da3fe8677">loadDropinSettings</a>())</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                    this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a> = tempSettings;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                    this-&gt;<a class="code" href="classuStepperSLite.html#a4bad2987e56031e2bf18b4bb49641312">saveDropinSettings</a>();</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                    EEPROM.put(<span class="keyword">sizeof</span>(<a class="code" href="structdropinCliSettings__t.html">dropinCliSettings_t</a>),this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#ab360463f25b89cd8192d284a6024c237">checksum</a>);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                    this-&gt;<a class="code" href="classuStepperSLite.html#ada5b6ce856fea6afe4d7491da3fe8677">loadDropinSettings</a>();</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                }</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            }</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            delay(10000);</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a6ac76703b3b02956d2da43e3bc38e879">dropinPrintHelp</a>();</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        }</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        {</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            <span class="comment">//Scale supplied controller coefficents. This is done to enable the user to use easier to manage numbers for these coefficients.</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#afd708364388d62b61f32755868540e59">pTerm</a> = <a class="code" href="classuStepperSLite.html#afd708364388d62b61f32755868540e59">pTerm</a>;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a157fb9075d4c6c451a7f8e43367df27a">iTerm</a> = <a class="code" href="classuStepperSLite.html#a157fb9075d4c6c451a7f8e43367df27a">iTerm</a> * ENCODERINTSAMPLETIME;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            this-&gt;<a class="code" href="classuStepperSLite.html#a5324ae9b6cfbb63a1b82433c7c2b77a1">dTerm</a> = <a class="code" href="classuStepperSLite.html#a5324ae9b6cfbb63a1b82433c7c2b77a1">dTerm</a> * ENCODERINTFREQ;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        }</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    }</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160; </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a2c225c30565d8afc6472db1682ec0f78">checkConnectorOrientation</a>(<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a>);</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#abf3fc82540c092e8a6c68d4580bedbf9">setHome</a>();</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160; </div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#afef8bec3d96458ee9d079df69283d8e3">pidDisabled</a> = 0;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    TCNT3 = 0;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    ICR3 = 159;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    TIFR3 = 0;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    TIMSK3 = (1 &lt;&lt; OCIE3A);</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    TCCR3A = (1 &lt;&lt; WGM31);</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    TCCR3B = (1 &lt;&lt; WGM32) | (1 &lt;&lt; WGM33);</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    sei();</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;}</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160; </div>
<div class="line"><a name="l01138"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#ae493894449c4fb212c6d09f9bcdd5278"> 1138</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#ae493894449c4fb212c6d09f9bcdd5278">uStepperSLite::enableMotor</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;{</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.<a class="code" href="classTmc2208.html#a648e00eda3d756b154a7d62572d5c12d">enableDriver</a>();                <span class="comment">//Enable motor driver</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;}</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160; </div>
<div class="line"><a name="l01143"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a1432dae31727fbfbed1a303262499f17"> 1143</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a1432dae31727fbfbed1a303262499f17">uStepperSLite::disableMotor</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;{</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.<a class="code" href="classTmc2208.html#af81bbf175de574f64f3f49f91a822705">disableDriver</a>();           <span class="comment">//Disable motor driver</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;}</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160; </div>
<div class="line"><a name="l01148"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a9522d6afb14f71c6034ece6537180e00"> 1148</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classuStepperSLite.html#a9522d6afb14f71c6034ece6537180e00">uStepperSLite::getCurrentDirection</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;{</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="keywordflow">return</span> this-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a>;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;}</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160; </div>
<div class="line"><a name="l01153"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#adeed207c50c8650d22dea4034bcdd587"> 1153</a></span>&#160;uint8_t <a class="code" href="classuStepperSLite.html#adeed207c50c8650d22dea4034bcdd587">uStepperSLite::getMotorState</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;{</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> != STOP)</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    {</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <span class="keywordflow">return</span> this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a>;     <span class="comment">//Motor running</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    }</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160; </div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordflow">return</span> 0;           <span class="comment">//Motor not running</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;}</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160; </div>
<div class="line"><a name="l01163"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#af64de6cee4e18b4ad23e4382b9218a2e"> 1163</a></span>&#160;int32_t <a class="code" href="classuStepperSLite.html#af64de6cee4e18b4ad23e4382b9218a2e">uStepperSLite::getStepsSinceReset</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;{</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordflow">return</span> this-&gt;<a class="code" href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">stepsSinceReset</a>;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;}</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; </div>
<div class="line"><a name="l01168"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#ab0895bb46175c172b902d23d6dbe7daa"> 1168</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#ab0895bb46175c172b902d23d6dbe7daa">uStepperSLite::setCurrent</a>(uint8_t runCurrent, uint8_t holdCurrent)</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;{</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.<a class="code" href="classTmc2208.html#a4b06e13fd845a3973324acfcdbed1c38">setCurrent</a>(runCurrent, holdCurrent);</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;}</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160; </div>
<div class="line"><a name="l01173"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a78bfc1598d8eb68a024cda81c6e6efc4"> 1173</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a78bfc1598d8eb68a024cda81c6e6efc4">uStepperSLite::setHoldCurrent</a>(uint8_t holdCurrent)</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;{</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.<a class="code" href="classTmc2208.html#a357f3feef7327c7c12cb6af33466e4ce">setHoldCurrent</a>(holdCurrent);</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;}</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160; </div>
<div class="line"><a name="l01178"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#acd6d73628d5caa20a63e01c0e6327488"> 1178</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#acd6d73628d5caa20a63e01c0e6327488">uStepperSLite::setRunCurrent</a>(uint8_t runCurrent)</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;{</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.<a class="code" href="classTmc2208.html#af06fd0ce5ab19d219c30cb10dd5d69b7">setRunCurrent</a>(runCurrent);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;}</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160; </div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">//Skal GennemgÃ¥s !</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a87ea117d2b589e26fa66db9927a7d0d6"> 1184</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classuStepperSLite.html#a87ea117d2b589e26fa66db9927a7d0d6">uStepperSLite::moveToEnd</a>(<span class="keywordtype">bool</span> dir, <span class="keywordtype">float</span> stallSensitivity)</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;{</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    uint8_t checks = 0;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="keywordtype">float</span> pos = 0.0;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordtype">float</span> lengthMoved;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">mode</a> == DROPIN)</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    {</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        <span class="keywordflow">return</span> 0.0;     <span class="comment">//Doesn&#39;t make sense in dropin mode</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160; </div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    lengthMoved = this-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a29117f4952ff99ba53b90b842f4e69f1">getAngleMoved</a>();</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160; </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#ae0833b2d44aeb4987cbf3ce734911185">stop</a>(HARD);</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    _delay_ms(50);</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#ab5bf3cf124d2d52fc06ce97c7651b081">runContinous</a>(dir);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    _delay_ms(200);</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="keywordflow">while</span>(!this-&gt;<a class="code" href="classuStepperSLite.html#a6f3915bfd82400799abc10498a57222f">isStalled</a>(stallSensitivity));</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#ae0833b2d44aeb4987cbf3ce734911185">stop</a>(SOFT);<span class="comment">//stop motor without brake</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160; </div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a1b876adeb71ec6f0f03dba8bb88df30c">moveSteps</a>(20, !dir, SOFT);</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="keywordflow">while</span>(this-&gt;<a class="code" href="classuStepperSLite.html#adeed207c50c8650d22dea4034bcdd587">getMotorState</a>())</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    {</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        _delay_ms(1);</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    }</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    _delay_ms(100);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <span class="keywordflow">if</span>(dir == CW)</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    {</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        lengthMoved = this-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a29117f4952ff99ba53b90b842f4e69f1">getAngleMoved</a>() - lengthMoved;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    }</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    {</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        lengthMoved -= this-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a29117f4952ff99ba53b90b842f4e69f1">getAngleMoved</a>();</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    }</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#abf3fc82540c092e8a6c68d4580bedbf9">setHome</a>();<span class="comment">//set new home position</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordflow">return</span> lengthMoved;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;}</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a10d7a7ee710c5cf58e0c80d0ce2d3a09"> 1223</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a10d7a7ee710c5cf58e0c80d0ce2d3a09">uStepperSLite::moveToAngle</a>(<span class="keywordtype">float</span> <a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a>, <span class="keywordtype">bool</span> holdMode)</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;{</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordtype">float</span> diff;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    uint32_t steps;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160; </div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    diff = <a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a> - this-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a29117f4952ff99ba53b90b842f4e69f1">getAngleMoved</a>();</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    steps = (uint32_t)((abs(diff)*<a class="code" href="classuStepperSLite.html#afd5ccf623308a2f47af9b58ff2e16023">angleToStep</a>) + 0.5);</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160; </div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="keywordflow">if</span>(diff &lt; 0.0)</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    {</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a1b876adeb71ec6f0f03dba8bb88df30c">moveSteps</a>(steps, CCW, holdMode);</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    }</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    {</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a1b876adeb71ec6f0f03dba8bb88df30c">moveSteps</a>(steps, CW, holdMode);</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;}</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160; </div>
<div class="line"><a name="l01241"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a702f67e1e3675882cb3a0c8d885d0567"> 1241</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a702f67e1e3675882cb3a0c8d885d0567">uStepperSLite::moveAngle</a>(<span class="keywordtype">float</span> <a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a>, <span class="keywordtype">bool</span> holdMode)</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;{</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    int32_t steps;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160; </div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a> &lt; 0.0)</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    {</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        steps = -(int32_t)((<a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a>*<a class="code" href="classuStepperSLite.html#afd5ccf623308a2f47af9b58ff2e16023">angleToStep</a>) - 0.5);</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a1b876adeb71ec6f0f03dba8bb88df30c">moveSteps</a>(steps, CCW, holdMode);</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    }</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    {</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        steps = (int32_t)((<a class="code" href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">angle</a>*<a class="code" href="classuStepperSLite.html#afd5ccf623308a2f47af9b58ff2e16023">angleToStep</a>) + 0.5);</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a1b876adeb71ec6f0f03dba8bb88df30c">moveSteps</a>(steps, CW, holdMode);</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    }</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;}</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#aa1acc67d587fdf8b686a0209d5a008c0"> 1257</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#aa1acc67d587fdf8b686a0209d5a008c0">uStepperSLite::pid</a>(<span class="keywordtype">float</span> error)</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;{</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="keywordtype">float</span> u, uSat, temp;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="keywordtype">float</span> limit = abs(this-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>) + 6000.0;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">float</span> integral;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> integralReset = 0;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    </div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#afef8bec3d96458ee9d079df69283d8e3">pidDisabled</a>)</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    {</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        integral = 0.0;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        integralReset = 0;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a2573e7e23d167d45682543c8993ab9f2">currentPidError</a> = 0.0;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> == STOP)</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        {</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;            <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a68872d29c8b0dd78742faff9578e320d">brake</a> == BRAKEON)</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;            {</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                PORTD &amp;= ~(1 &lt;&lt; 4);</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;            }</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;            {</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                PORTD |= (1 &lt;&lt; 4);</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;            }</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        }</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        </div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    }</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160; </div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    PORTD &amp;= ~(1 &lt;&lt; 4);</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160; </div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a2573e7e23d167d45682543c8993ab9f2">currentPidError</a> = error;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160; </div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    u = error*this-&gt;<a class="code" href="classuStepperSLite.html#afd708364388d62b61f32755868540e59">pTerm</a>;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160; </div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keywordflow">if</span>(u &gt; 0.0)</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    {</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        <span class="keywordflow">if</span>(u &gt; limit)</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        {</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;            u = limit;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        }</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    }</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(u &lt; 0.0)</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    {</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        <span class="keywordflow">if</span>(u &lt; -limit)</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            u = -limit;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        }</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    }</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160; </div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    integral += error*this-&gt;<a class="code" href="classuStepperSLite.html#a157fb9075d4c6c451a7f8e43367df27a">iTerm</a>;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160; </div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <span class="keywordflow">if</span>(integral &gt; 10000.0)</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    {</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        integral = 10000.0;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    }</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(integral &lt; -10000.0)</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    {</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        integral = -10000.0;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    }</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160; </div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    u += integral;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160; </div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keywordflow">if</span>(u &gt; 100000 || u &lt; -100000)</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    {</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        uSat = 100000;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        uSat = ((u &gt; 0) - (u &lt; 0)) * uSat;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    }</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    {</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        uSat = u;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    }</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160; </div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="keywordflow">if</span>(error &lt; -2.0 || error &gt; 2.0)</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    {</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        <span class="keywordflow">if</span>(error &lt; 0.0)</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        {</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;            <span class="keywordflow">if</span>(error &lt; -255.0)</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;            {</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                this-&gt;<a class="code" href="classuStepperSLite.html#a0383041fd93699cb06f857e8680ddf73">pidError</a> = 255;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            }</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;            {</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                this-&gt;<a class="code" href="classuStepperSLite.html#a0383041fd93699cb06f857e8680ddf73">pidError</a> = (uint8_t)-error;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;            }</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        }</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;        {</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;            <span class="keywordflow">if</span>(error &gt; 255.0)</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;            {</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                this-&gt;<a class="code" href="classuStepperSLite.html#a0383041fd93699cb06f857e8680ddf73">pidError</a> = 255;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;            }</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;            {</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                this-&gt;<a class="code" href="classuStepperSLite.html#a0383041fd93699cb06f857e8680ddf73">pidError</a> = (uint8_t)error;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;            }</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        }</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        TCCR3B |= (1 &lt;&lt; CS30);</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    }</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    {</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160; </div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> == STOP)</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        {</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            TCCR3B &amp;= ~(1 &lt;&lt; CS30);</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        }</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a0383041fd93699cb06f857e8680ddf73">pidError</a> = 0;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    }</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160; </div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="keywordflow">if</span>(uSat &gt; 5.0)</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    {</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        temp = (uint32_t)((STEPGENERATORFREQUENCY/uSat) + 0.5);</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#aaf8a4bd9baac5f7370a33bbf439983ad">stepGeneratorDirection</a> = CW;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160; </div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        cli();</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = temp;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        sei();</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    }</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(uSat &lt; -5.0)</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    {</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#aaf8a4bd9baac5f7370a33bbf439983ad">stepGeneratorDirection</a> = CCW;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160; </div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        temp = (uint32_t)((STEPGENERATORFREQUENCY/-uSat) + 0.5);</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        cli();</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = temp;</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        sei();</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    }</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(uSat &gt; 0.0)</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    {</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#aaf8a4bd9baac5f7370a33bbf439983ad">stepGeneratorDirection</a> = CW;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        cli();</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = 20000;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        sei();</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    }</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(uSat &lt; 0.0)</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    {</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#aaf8a4bd9baac5f7370a33bbf439983ad">stepGeneratorDirection</a> = CCW;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160; </div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        cli();</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = 20000;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        sei();</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    }</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    {</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#aaf8a4bd9baac5f7370a33bbf439983ad">stepGeneratorDirection</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">direction</a>;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        cli();</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        pointer-&gt;<a class="code" href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">stepDelay</a> = 20000;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        sei();</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    }</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;}</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160; </div>
<div class="line"><a name="l01406"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a823c0099863617f8bb4b61ea1a4d1775"> 1406</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a823c0099863617f8bb4b61ea1a4d1775">uStepperSLite::disablePid</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;{</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#afef8bec3d96458ee9d079df69283d8e3">pidDisabled</a> = 1;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;}</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160; </div>
<div class="line"><a name="l01411"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a1aa954540615bd51a5e2c2ba291e7016"> 1411</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a1aa954540615bd51a5e2c2ba291e7016">uStepperSLite::enablePid</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;{</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    cli();</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#afef8bec3d96458ee9d079df69283d8e3">pidDisabled</a> = 0;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a> = this-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a0156342c81b94ab3f7ef176494205f65">angleMoved</a> * this-&gt;<a class="code" href="classuStepperSLite.html#a539b0579a291bb4b3c6f4d3680db237f">stepConversion</a>;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">targetPosition</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a>;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">state</a> = STOP;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a0383041fd93699cb06f857e8680ddf73">pidError</a> = 0;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    sei();</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;}</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160; </div>
<div class="line"><a name="l01422"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#afc2f4ad942520df8dcc6aa20180c5197"> 1422</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classuStepperSLite.html#afc2f4ad942520df8dcc6aa20180c5197">uStepperSLite::getPidError</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;{</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keywordflow">return</span> this-&gt;<a class="code" href="classuStepperSLite.html#a2573e7e23d167d45682543c8993ab9f2">currentPidError</a>;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;}</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160; </div>
<div class="line"><a name="l01427"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a1f52578e510fe01d10bb464d84133395"> 1427</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a1f52578e510fe01d10bb464d84133395">uStepperSLite::pidDropin</a>(<span class="keywordtype">float</span> error)</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;{</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordtype">float</span> u;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keywordtype">float</span> limit = abs(this-&gt;<a class="code" href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">currentPidSpeed</a>) + 6000.0;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">float</span> integral;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> integralReset = 0;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160; </div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    PORTD &amp;= ~(1 &lt;&lt; 4);</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160; </div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a2573e7e23d167d45682543c8993ab9f2">currentPidError</a> = error;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160; </div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    u = error*this-&gt;<a class="code" href="classuStepperSLite.html#afd708364388d62b61f32755868540e59">pTerm</a>;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160; </div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    <span class="keywordflow">if</span>(u &gt; 0.0)</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    {</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        <span class="keywordflow">if</span>(u &gt; limit)</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        {</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;            u = limit;</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        }</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    }</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(u &lt; 0.0)</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    {</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        <span class="keywordflow">if</span>(u &lt; -limit)</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        {</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;            u = -limit;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        }</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    }</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160; </div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    integral += error*this-&gt;<a class="code" href="classuStepperSLite.html#a157fb9075d4c6c451a7f8e43367df27a">iTerm</a>;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160; </div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <span class="keywordflow">if</span>(integral &gt; 10000.0)</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    {</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        integral = 10000.0;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    }</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(integral &lt; -10000.0)</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    {</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        integral = -10000.0;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    }</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160; </div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <span class="keywordflow">if</span>(error &gt; -10 &amp;&amp; error &lt; 10)</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    {</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        <span class="keywordflow">if</span>(!integralReset)</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        {</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;            integralReset = 1;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;            integral = 0;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        }</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    }</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    {</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        integralReset = 0;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    }</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160; </div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    u += integral;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    u *= this-&gt;<a class="code" href="classuStepperSLite.html#a2b91360df7f167a7029770f55b3dcf2d">stepsPerSecondToRPM</a>;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160; </div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.<a class="code" href="classTmc2208.html#a713c10d6a967323926e83e63d919ca13">setVelocity</a>(u);</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;}</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160; </div>
<div class="line"><a name="l01485"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a833a6e3a84ee1ed1b6a1ec974d59ba2f"> 1485</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classuStepperSLite.html#a833a6e3a84ee1ed1b6a1ec974d59ba2f">uStepperSLite::detectStall</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;{</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">float</span> oldTargetPosition;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">float</span> oldEncoderPosition;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">float</span> encoderPositionChange;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">float</span> targetPositionChange;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordtype">float</span> encoderPosition = ((float)this-&gt;<a class="code" href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">encoder</a>.<a class="code" href="classuStepperEncoder.html#a0156342c81b94ab3f7ef176494205f65">angleMoved</a>*this-&gt;stepConversion);</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">float</span> internalStall = 0.0;</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160; </div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    encoderPositionChange *= 0.99;</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    encoderPositionChange += 0.01*(oldEncoderPosition - encoderPosition);</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    oldEncoderPosition = encoderPosition;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    targetPositionChange *= 0.99;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    targetPositionChange += 0.01*(oldTargetPosition - this-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a>);</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    oldTargetPosition = this-&gt;<a class="code" href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">pidTargetPosition</a>;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160; </div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordflow">if</span>(abs(encoderPositionChange) &lt; abs(targetPositionChange)*0.5)</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    {</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        internalStall *= this-&gt;<a class="code" href="classuStepperSLite.html#a06ea99f74b92b86a9ee098a31bef6c08">stallSensitivity</a>;</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        internalStall += 1.0-this-&gt;<a class="code" href="classuStepperSLite.html#a06ea99f74b92b86a9ee098a31bef6c08">stallSensitivity</a>;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    }</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    {</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        internalStall *= this-&gt;<a class="code" href="classuStepperSLite.html#a06ea99f74b92b86a9ee098a31bef6c08">stallSensitivity</a>;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    }</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    </div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="keywordflow">if</span>(internalStall &gt;= 0.95)       <span class="comment">//3 timeconstants</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    {</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#aa3d8c0808aa478933e47cde6ccd4f1f6">stall</a> = 1;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    }</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    {</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#aa3d8c0808aa478933e47cde6ccd4f1f6">stall</a> = 0;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    }</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;}</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160; </div>
<div class="line"><a name="l01522"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a6f3915bfd82400799abc10498a57222f"> 1522</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classuStepperSLite.html#a6f3915bfd82400799abc10498a57222f">uStepperSLite::isStalled</a>(<span class="keywordtype">float</span> stallSensitivity)</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;{</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <span class="keywordflow">if</span>(this-&gt;stallSensitivity &gt; 1.0)</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    {</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        this-&gt;stallSensitivity = 1.0;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    }</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(this-&gt;stallSensitivity &lt; 0.0)</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    {</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;        this-&gt;stallSensitivity = 0.0;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    }</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        this-&gt;stallSensitivity = <a class="code" href="classuStepperSLite.html#a06ea99f74b92b86a9ee098a31bef6c08">stallSensitivity</a>;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    }</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    </div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    <span class="keywordflow">return</span> this-&gt;<a class="code" href="classuStepperSLite.html#aa3d8c0808aa478933e47cde6ccd4f1f6">stall</a>;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;}</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160; </div>
<div class="line"><a name="l01539"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a41d04fb191c2799613aa8fe810712152"> 1539</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a41d04fb191c2799613aa8fe810712152">uStepperSLite::setProportional</a>(<span class="keywordtype">float</span> P)</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;{</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#afd708364388d62b61f32755868540e59">pTerm</a> = P;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;}</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160; </div>
<div class="line"><a name="l01544"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a6aeca80444771d28fcd3e76b2c81b59a"> 1544</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a6aeca80444771d28fcd3e76b2c81b59a">uStepperSLite::setIntegral</a>(<span class="keywordtype">float</span> I)</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;{</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a157fb9075d4c6c451a7f8e43367df27a">iTerm</a> = I * ENCODERINTSAMPLETIME; </div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;}</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160; </div>
<div class="line"><a name="l01549"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a276ca3c9c340cc55fa0e098cbbf1f7c3"> 1549</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a276ca3c9c340cc55fa0e098cbbf1f7c3">uStepperSLite::setDifferential</a>(<span class="keywordtype">float</span> D)</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;{</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a5324ae9b6cfbb63a1b82433c7c2b77a1">dTerm</a> = D * ENCODERINTFREQ;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;}</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160; </div>
<div class="line"><a name="l01554"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a202e10e4febc21ae6cb6aeb67d8d7f59"> 1554</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a202e10e4febc21ae6cb6aeb67d8d7f59">uStepperSLite::invertDropinDir</a>(<span class="keywordtype">bool</span> invert)</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;{</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a1d1ce82b808fe8bb9ee71f91e9fae009">invertPidDropinDirection</a> = invert;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;}</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160; </div>
<div class="line"><a name="l01559"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a54011dd2ecd8b93d6037f603a2af320c"> 1559</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a54011dd2ecd8b93d6037f603a2af320c">uStepperSLite::parseCommand</a>(String *cmd)</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;{</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  uint8_t i = 0;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  String value;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160; </div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordflow">if</span>(cmd-&gt;charAt(2) == <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  {</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  }</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160; </div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  value.remove(0);</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="comment">  /****************** SET P Parameter ***************************</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment">  **************************************************************/</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  <span class="keywordflow">if</span>(cmd-&gt;substring(0,2) == String(<span class="stringliteral">&quot;P=&quot;</span>))</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  {</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <span class="keywordflow">for</span>(i = 2;;i++)</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    {</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(i) &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; cmd-&gt;charAt(i) &lt;= <span class="charliteral">&#39;9&#39;</span>)</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      {</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      }</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      {</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;        i++;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;      }</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      {</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;      }</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;      {</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;      }</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    }</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    </div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="keywordflow">for</span>(;;i++)</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    {</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(i) &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; cmd-&gt;charAt(i) &lt;= <span class="charliteral">&#39;9&#39;</span>)</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      {</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      }</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      {</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        Serial.print(<span class="stringliteral">&quot;COMMAND ACCEPTED. P = &quot;</span>);</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        Serial.println(value.toFloat(),4);</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#ac2ae5becda6e7d44075f51d81acc0147">P</a>.<a class="code" href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">f</a> = value.toFloat();</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a4bad2987e56031e2bf18b4bb49641312">saveDropinSettings</a>();</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a41d04fb191c2799613aa8fe810712152">setProportional</a>(value.toFloat());</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;      }</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;      {</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      }</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    }</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  }</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160; </div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment">/****************** SET I Parameter ***************************</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">  **************************************************************/</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;substring(0,2) == String(<span class="stringliteral">&quot;I=&quot;</span>))</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  {</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    <span class="keywordflow">for</span>(i = 2;;i++)</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    {</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(i) &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; cmd-&gt;charAt(i) &lt;= <span class="charliteral">&#39;9&#39;</span>)</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      {</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      }</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;      {</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;        i++;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;      }</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      {</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;      }</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      {</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;      }</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    }</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    </div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="keywordflow">for</span>(;;i++)</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    {</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(i) &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; cmd-&gt;charAt(i) &lt;= <span class="charliteral">&#39;9&#39;</span>)</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;      {</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      }</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;      {</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        Serial.print(<span class="stringliteral">&quot;COMMAND ACCEPTED. I = &quot;</span>);</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        Serial.println(value.toFloat(),4);</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160; </div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#aa3341deb156fc6151de8794e43459732">I</a>.<a class="code" href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">f</a> = value.toFloat();</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a4bad2987e56031e2bf18b4bb49641312">saveDropinSettings</a>();</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a6aeca80444771d28fcd3e76b2c81b59a">setIntegral</a>(value.toFloat());</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      }</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      {</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      }</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    }</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  }</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160; </div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment">/****************** SET D Parameter ***************************</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="comment">  **************************************************************/</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;substring(0,2) == String(<span class="stringliteral">&quot;D=&quot;</span>))</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  {</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    <span class="keywordflow">for</span>(i = 2;;i++)</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    {</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(i) &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; cmd-&gt;charAt(i) &lt;= <span class="charliteral">&#39;9&#39;</span>)</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      {</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;      }</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      {</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        i++;</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;      }</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      {</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      }</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;      {</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      }</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    }</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    </div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="keywordflow">for</span>(;;i++)</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    {</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(i) &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; cmd-&gt;charAt(i) &lt;= <span class="charliteral">&#39;9&#39;</span>)</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;      {</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;      }</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;      {</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;        Serial.print(<span class="stringliteral">&quot;COMMAND ACCEPTED. D = &quot;</span>);</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        Serial.println(value.toFloat(),4);</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#a00ded376c02dfc7d764f07d4ed8b47fd">D</a>.<a class="code" href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">f</a> = value.toFloat();</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a4bad2987e56031e2bf18b4bb49641312">saveDropinSettings</a>();</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a276ca3c9c340cc55fa0e098cbbf1f7c3">setDifferential</a>(value.toFloat());</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      }</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;      {</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      }</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    }</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  }</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160; </div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;<span class="comment">/****************** invert Direction ***************************</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="comment">  **************************************************************/</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;substring(0,6) == String(<span class="stringliteral">&quot;invert&quot;</span>))</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;  {</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(6) != <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;      {</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;      }</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a1d1ce82b808fe8bb9ee71f91e9fae009">invertPidDropinDirection</a>)</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;      {</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        Serial.println(F(<span class="stringliteral">&quot;Direction normal!&quot;</span>));</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#a5746cba668768ac204a54751bc932271">invert</a> = 0;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a4bad2987e56031e2bf18b4bb49641312">saveDropinSettings</a>();</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a202e10e4febc21ae6cb6aeb67d8d7f59">invertDropinDir</a>(0);</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;      }</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;      {</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;        Serial.println(F(<span class="stringliteral">&quot;Direction inverted!&quot;</span>));</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#a5746cba668768ac204a54751bc932271">invert</a> = 1;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a4bad2987e56031e2bf18b4bb49641312">saveDropinSettings</a>();</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;        this-&gt;<a class="code" href="classuStepperSLite.html#a202e10e4febc21ae6cb6aeb67d8d7f59">invertDropinDir</a>(1);</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      }</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  }</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160; </div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;<span class="comment">  /****************** get Current Pid Error ********************</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="comment">  **************************************************************/</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;substring(0,5) == String(<span class="stringliteral">&quot;error&quot;</span>))</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  {</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(5) != <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;      {</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;      }</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;      Serial.print(F(<span class="stringliteral">&quot;Current Error: &quot;</span>));</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;      Serial.print(this-&gt;<a class="code" href="classuStepperSLite.html#afc2f4ad942520df8dcc6aa20180c5197">getPidError</a>());</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;      Serial.println(F(<span class="stringliteral">&quot; Steps&quot;</span>));</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  }</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160; </div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment">  /****************** Get run/hold current settings ************</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment">  **************************************************************/</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;substring(0,7) == String(<span class="stringliteral">&quot;current&quot;</span>))</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;  {</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(7) != <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;      {</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      }</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;      Serial.print(F(<span class="stringliteral">&quot;Run Current: &quot;</span>));</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      Serial.print(this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.getRunCurrent());</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      Serial.println(F(<span class="stringliteral">&quot; %&quot;</span>));</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;      Serial.print(F(<span class="stringliteral">&quot;Hold Current: &quot;</span>));</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;      Serial.print(this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.getHoldCurrent());</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;      Serial.println(F(<span class="stringliteral">&quot; %&quot;</span>));</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  }</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160; </div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment">  /****************** Get PID Parameters ***********************</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="comment">  **************************************************************/</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;substring(0,10) == String(<span class="stringliteral">&quot;parameters&quot;</span>))</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  {</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(10) != <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;      {</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;      }</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;      Serial.print(F(<span class="stringliteral">&quot;P: &quot;</span>));</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      Serial.print(this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#ac2ae5becda6e7d44075f51d81acc0147">P</a>.<a class="code" href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">f</a>,4);</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      Serial.print(F(<span class="stringliteral">&quot;, &quot;</span>));</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      Serial.print(F(<span class="stringliteral">&quot;I: &quot;</span>));</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;      Serial.print(this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#aa3341deb156fc6151de8794e43459732">I</a>.<a class="code" href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">f</a>,4);</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;      Serial.print(F(<span class="stringliteral">&quot;, &quot;</span>));</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;      Serial.print(F(<span class="stringliteral">&quot;D: &quot;</span>));</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      Serial.println(this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#a00ded376c02dfc7d764f07d4ed8b47fd">D</a>.<a class="code" href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">f</a>,4);</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;  }</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160; </div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">  /****************** Help menu ********************************</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment">  **************************************************************/</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;substring(0,4) == String(<span class="stringliteral">&quot;help&quot;</span>))</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  {</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(4) != <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;      {</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;      }</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;      this-&gt;<a class="code" href="classuStepperSLite.html#a6ac76703b3b02956d2da43e3bc38e879">dropinPrintHelp</a>();</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  }</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  </div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="comment">/****************** SET run current ***************************</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment">  **************************************************************/</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;substring(0,11) == String(<span class="stringliteral">&quot;runCurrent=&quot;</span>))</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  {</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    <span class="keywordflow">for</span>(i = 11;;i++)</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    {</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(i) &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; cmd-&gt;charAt(i) &lt;= <span class="charliteral">&#39;9&#39;</span>)</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      {</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;      }</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;      {</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        i++;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      }</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      {</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;      }</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;      {</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      }</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    }</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    </div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    <span class="keywordflow">for</span>(;;i++)</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    {</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(i) &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; cmd-&gt;charAt(i) &lt;= <span class="charliteral">&#39;9&#39;</span>)</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      {</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      }</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      {</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        <span class="keywordflow">if</span>(value.toFloat() &gt;= 0.0 &amp;&amp; value.toFloat() &lt;= 100.0)</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        {</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;            i = (uint8_t)value.toFloat();</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;            <span class="keywordflow">break</span>;  </div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        }</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        {</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;            Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;        }</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;      }</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      {</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;        Serial.println(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>);</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      }</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    }</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160; </div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    Serial.print(<span class="stringliteral">&quot;COMMAND ACCEPTED. runCurrent = &quot;</span>);</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    Serial.print(i);</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    Serial.println(F(<span class="stringliteral">&quot; %&quot;</span>));</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#ac36b9ae1990fb507c66fda2bacee5bf9">runCurrent</a> = i;</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a4bad2987e56031e2bf18b4bb49641312">saveDropinSettings</a>();</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.<a class="code" href="classTmc2208.html#af06fd0ce5ab19d219c30cb10dd5d69b7">setRunCurrent</a>(i);</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;  }</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160; </div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">  /****************** SET run current ***************************</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">  **************************************************************/</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;substring(0,12) == String(<span class="stringliteral">&quot;holdCurrent=&quot;</span>))</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;  {</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    <span class="keywordflow">for</span>(i = 12;;i++)</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    {</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(i) &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; cmd-&gt;charAt(i) &lt;= <span class="charliteral">&#39;9&#39;</span>)</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      {</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;      }</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;.&#39;</span>)</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;      {</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;        i++;</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;      }</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;      {</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;      }</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;      {</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;        Serial.println(F(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>));</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;      }</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    }</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    </div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <span class="keywordflow">for</span>(;;i++)</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    {</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      <span class="keywordflow">if</span>(cmd-&gt;charAt(i) &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; cmd-&gt;charAt(i) &lt;= <span class="charliteral">&#39;9&#39;</span>)</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      {</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        value.concat(cmd-&gt;charAt(i));</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;      }</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cmd-&gt;charAt(i) == <span class="charliteral">&#39;;&#39;</span>)</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      {</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        <span class="keywordflow">if</span>(value.toFloat() &gt;= 0.0 &amp;&amp; value.toFloat() &lt;= 100.0)</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        {</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;            i = (uint8_t)value.toFloat();</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;            <span class="keywordflow">break</span>;  </div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        }</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;        {</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;            Serial.println(F(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>));</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;        }</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;      }</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      {</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;        Serial.println(F(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>));</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      }</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    }</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160; </div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    Serial.print(F(<span class="stringliteral">&quot;COMMAND ACCEPTED. holdCurrent = &quot;</span>));</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    Serial.print(i);</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    Serial.println(F(<span class="stringliteral">&quot; %&quot;</span>));</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#a447e69fba3c710086e68b7659bd919d7">holdCurrent</a> = i;</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a4bad2987e56031e2bf18b4bb49641312">saveDropinSettings</a>();</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">driver</a>.<a class="code" href="classTmc2208.html#a357f3feef7327c7c12cb6af33466e4ce">setHoldCurrent</a>(i);</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;  }</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160; </div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="comment">  /****************** DEFAULT (Reject!) ************************</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="comment">  *                                                            *</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="comment">  **************************************************************/</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;  {</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;COMMAND NOT ACCEPTED&quot;</span>));</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  }</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;  </div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;}</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160; </div>
<div class="line"><a name="l01965"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#acbf77fec7a15ae675a19045f2f500ba9"> 1965</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#acbf77fec7a15ae675a19045f2f500ba9">uStepperSLite::dropinCli</a>()</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;{</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="keyword">static</span> String stringInput;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    <span class="keyword">static</span> uint32_t t = millis();</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160; </div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    <span class="keywordflow">while</span>(1)</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    {</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        <span class="keywordflow">while</span>(!Serial.available())</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;        {</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;            delay(1);</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;            <span class="keywordflow">if</span>((millis() - t) &gt;= 500)</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;            {</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                stringInput.remove(0);</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                t = millis();</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;            }</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        }</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        t = millis();</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;        stringInput += (char)Serial.read();</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;        <span class="keywordflow">if</span>(stringInput.lastIndexOf(<span class="charliteral">&#39;;&#39;</span>) &gt; -1)</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;        {</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;          this-&gt;<a class="code" href="classuStepperSLite.html#a54011dd2ecd8b93d6037f603a2af320c">parseCommand</a>(&amp;stringInput);</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;          stringInput.remove(0);</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        }</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;    }</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;}</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160; </div>
<div class="line"><a name="l01991"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a6ac76703b3b02956d2da43e3bc38e879"> 1991</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a6ac76703b3b02956d2da43e3bc38e879">uStepperSLite::dropinPrintHelp</a>()</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;{</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;uStepper S-lite Dropin !&quot;</span>));</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;Usage:&quot;</span>));</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;Show this command list: &#39;help;&#39;&quot;</span>));</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;Get PID Parameters: &#39;parameters;&#39;&quot;</span>));</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;Set Proportional constant: &#39;P=10.002;&#39;&quot;</span>));</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;Set Integral constant: &#39;I=10.002;&#39;&quot;</span>));</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;Set Differential constant: &#39;D=10.002;&#39;&quot;</span>));</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;Invert Direction: &#39;invert;&#39;&quot;</span>));</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;Get Current PID Error: &#39;error;&#39;&quot;</span>));</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;Get Run/Hold Current Settings: &#39;current;&#39;&quot;</span>));</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;Set Run Current (percent): &#39;runCurrent=50.0;&#39;&quot;</span>));</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;Set Hold Current (percent): &#39;holdCurrent=50.0;&#39;&quot;</span>));</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;    Serial.println(F(<span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;}</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160; </div>
<div class="line"><a name="l02010"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#ada5b6ce856fea6afe4d7491da3fe8677"> 2010</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classuStepperSLite.html#ada5b6ce856fea6afe4d7491da3fe8677">uStepperSLite::loadDropinSettings</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;{</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    <a class="code" href="structdropinCliSettings__t.html">dropinCliSettings_t</a> tempSettings;</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160; </div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    EEPROM.get(0,tempSettings);</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160; </div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classuStepperSLite.html#a7cdcebc3e378c9aa5a849e75616bfb81">dropinSettingsCalcChecksum</a>(&amp;tempSettings) != tempSettings.<a class="code" href="structdropinCliSettings__t.html#ab360463f25b89cd8192d284a6024c237">checksum</a>)</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    {</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    }</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160; </div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a> = tempSettings;</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a41d04fb191c2799613aa8fe810712152">setProportional</a>(this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#ac2ae5becda6e7d44075f51d81acc0147">P</a>.<a class="code" href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">f</a>);</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a6aeca80444771d28fcd3e76b2c81b59a">setIntegral</a>(this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#aa3341deb156fc6151de8794e43459732">I</a>.<a class="code" href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">f</a>);</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a276ca3c9c340cc55fa0e098cbbf1f7c3">setDifferential</a>(this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#a00ded376c02dfc7d764f07d4ed8b47fd">D</a>.<a class="code" href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">f</a>);</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a202e10e4febc21ae6cb6aeb67d8d7f59">invertDropinDir</a>((<span class="keywordtype">bool</span>)this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#a5746cba668768ac204a54751bc932271">invert</a>);</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#ab0895bb46175c172b902d23d6dbe7daa">setCurrent</a>(this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#ac36b9ae1990fb507c66fda2bacee5bf9">runCurrent</a>,this-&gt;dropinSettings.holdCurrent); </div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;}</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160; </div>
<div class="line"><a name="l02030"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a4bad2987e56031e2bf18b4bb49641312"> 2030</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classuStepperSLite.html#a4bad2987e56031e2bf18b4bb49641312">uStepperSLite::saveDropinSettings</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;{</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>.<a class="code" href="structdropinCliSettings__t.html#ab360463f25b89cd8192d284a6024c237">checksum</a> = this-&gt;<a class="code" href="classuStepperSLite.html#a7cdcebc3e378c9aa5a849e75616bfb81">dropinSettingsCalcChecksum</a>(&amp;this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>);</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160; </div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    EEPROM.put(0,this-&gt;<a class="code" href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">dropinSettings</a>);</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;}</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160; </div>
<div class="line"><a name="l02037"></a><span class="lineno"><a class="line" href="classuStepperSLite.html#a7cdcebc3e378c9aa5a849e75616bfb81"> 2037</a></span>&#160;uint8_t <a class="code" href="classuStepperSLite.html#a7cdcebc3e378c9aa5a849e75616bfb81">uStepperSLite::dropinSettingsCalcChecksum</a>(<a class="code" href="structdropinCliSettings__t.html">dropinCliSettings_t</a> *settings)</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;{</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    uint8_t i;</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    uint8_t checksum = 0xAA;</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    uint8_t *p = (uint8_t*)settings;</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160; </div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <span class="keywordflow">for</span>(i=0; i &lt; 15; i++)</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    {       </div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        checksum ^= *p++;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    }</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160; </div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    <span class="keywordflow">return</span> checksum;</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclassuStepperSLite_html_ac03777fd1567d5551bea99a78361b5f9"><div class="ttname"><a href="classuStepperSLite.html#ac03777fd1567d5551bea99a78361b5f9">uStepperSLite::currentPidAcceleration</a></div><div class="ttdeci">volatile float currentPidAcceleration</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00552">uStepperSLite.h:552</a></div></div>
<div class="ttc" id="ai2cMaster_8h_html_a46fd28b671402790a8b9c4c2dde700d8"><div class="ttname"><a href="i2cMaster_8h.html#a46fd28b671402790a8b9c4c2dde700d8">I2CFREE</a></div><div class="ttdeci">#define I2CFREE</div><div class="ttdef"><b>Definition:</b> <a href="i2cMaster_8h_source.html#l00044">i2cMaster.h:43</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_acfaebfbd6ccc435e71c1dd78d39970d4"><div class="ttname"><a href="classuStepperSLite.html#acfaebfbd6ccc435e71c1dd78d39970d4">uStepperSLite::velocity</a></div><div class="ttdeci">float velocity</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00489">uStepperSLite.h:489</a></div></div>
<div class="ttc" id="astructdropinCliSettings__t_html_ac2ae5becda6e7d44075f51d81acc0147"><div class="ttname"><a href="structdropinCliSettings__t.html#ac2ae5becda6e7d44075f51d81acc0147">dropinCliSettings_t::P</a></div><div class="ttdeci">floatBytes_t P</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00156">uStepperSLite.h:156</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a2b91360df7f167a7029770f55b3dcf2d"><div class="ttname"><a href="classuStepperSLite.html#a2b91360df7f167a7029770f55b3dcf2d">uStepperSLite::stepsPerSecondToRPM</a></div><div class="ttdeci">float stepsPerSecondToRPM</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00508">uStepperSLite.h:508</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_ae19871928f7fbe4a1b69270a8cec7932"><div class="ttname"><a href="classuStepperEncoder.html#ae19871928f7fbe4a1b69270a8cec7932">uStepperEncoder::angle</a></div><div class="ttdeci">volatile uint16_t angle</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00320">uStepperSLite.h:320</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html"><div class="ttname"><a href="classuStepperSLite.html">uStepperSLite</a></div><div class="ttdoc">Prototype of class for accessing all features of the uStepper S-lite in a single object.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00437">uStepperSLite.h:438</a></div></div>
<div class="ttc" id="aclassTmc2208_html_a1576b8921751c68fff4a161453c99223"><div class="ttname"><a href="classTmc2208.html#a1576b8921751c68fff4a161453c99223">Tmc2208::invertDirection</a></div><div class="ttdeci">void invertDirection(bool normal=INVERSEDIRECTION)</div><div class="ttdoc">Invert motor direction.</div><div class="ttdef"><b>Definition:</b> <a href="TMC2208_8cpp_source.html#l00133">TMC2208.cpp:133</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_abcf80a395cfddcd61ba96b3e9828a06f"><div class="ttname"><a href="classuStepperSLite.html#abcf80a395cfddcd61ba96b3e9828a06f">uStepperSLite::encoder</a></div><div class="ttdeci">uStepperEncoder encoder</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00628">uStepperSLite.h:628</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a981108d4f2ebd08818beb2cffce8d691"><div class="ttname"><a href="classuStepperSLite.html#a981108d4f2ebd08818beb2cffce8d691">uStepperSLite::acceleration</a></div><div class="ttdeci">float acceleration</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00497">uStepperSLite.h:497</a></div></div>
<div class="ttc" id="aclassTmc2208_html_a4b06e13fd845a3973324acfcdbed1c38"><div class="ttname"><a href="classTmc2208.html#a4b06e13fd845a3973324acfcdbed1c38">Tmc2208::setCurrent</a></div><div class="ttdeci">void setCurrent(uint8_t runPercent, uint8_t holdPercent)</div><div class="ttdoc">Change run and hold current settings of the stepper motor driver - TMC2208.</div><div class="ttdef"><b>Definition:</b> <a href="TMC2208_8cpp_source.html#l00196">TMC2208.cpp:196</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a807c3fe887eb2ad6c7a099824e2d2b99"><div class="ttname"><a href="classuStepperSLite.html#a807c3fe887eb2ad6c7a099824e2d2b99">uStepperSLite::cruiseToDecelThreshold</a></div><div class="ttdeci">volatile int32_t cruiseToDecelThreshold</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00546">uStepperSLite.h:546</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_ab46a2701ac9bee37e0f598a2f5306158"><div class="ttname"><a href="classuStepperSLite.html#ab46a2701ac9bee37e0f598a2f5306158">uStepperSLite::RPMToStepsPerSecond</a></div><div class="ttdeci">float RPMToStepsPerSecond</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00511">uStepperSLite.h:511</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a6f3915bfd82400799abc10498a57222f"><div class="ttname"><a href="classuStepperSLite.html#a6f3915bfd82400799abc10498a57222f">uStepperSLite::isStalled</a></div><div class="ttdeci">bool isStalled(float stallSensitivity=0.992)</div><div class="ttdoc">This method returns a bool variable indicating wether the motor is stalled or not.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01522">uStepperSLite.cpp:1522</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_ab5bf3cf124d2d52fc06ce97c7651b081"><div class="ttname"><a href="classuStepperSLite.html#ab5bf3cf124d2d52fc06ce97c7651b081">uStepperSLite::runContinous</a></div><div class="ttdeci">void runContinous(bool dir)</div><div class="ttdoc">Make the motor rotate continuously.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00584">uStepperSLite.cpp:584</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a202e10e4febc21ae6cb6aeb67d8d7f59"><div class="ttname"><a href="classuStepperSLite.html#a202e10e4febc21ae6cb6aeb67d8d7f59">uStepperSLite::invertDropinDir</a></div><div class="ttdeci">void invertDropinDir(bool invert)</div><div class="ttdoc">This method is used to invert the drop-in direction pin interpretation.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01554">uStepperSLite.cpp:1554</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a7bd2be0bdf8c9cec85d39b74d6aa4728"><div class="ttname"><a href="classuStepperSLite.html#a7bd2be0bdf8c9cec85d39b74d6aa4728">uStepperSLite::accelToCruiseThreshold</a></div><div class="ttdeci">volatile int32_t accelToCruiseThreshold</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00543">uStepperSLite.h:543</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_a0156342c81b94ab3f7ef176494205f65"><div class="ttname"><a href="classuStepperEncoder.html#a0156342c81b94ab3f7ef176494205f65">uStepperEncoder::angleMoved</a></div><div class="ttdeci">volatile int32_t angleMoved</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00308">uStepperSLite.h:308</a></div></div>
<div class="ttc" id="aclassTmc2208_html_a713c10d6a967323926e83e63d919ca13"><div class="ttname"><a href="classTmc2208.html#a713c10d6a967323926e83e63d919ca13">Tmc2208::setVelocity</a></div><div class="ttdeci">void setVelocity(float RPM)</div><div class="ttdoc">Set motor velocity in RPM.</div><div class="ttdef"><b>Definition:</b> <a href="TMC2208_8cpp_source.html#l00228">TMC2208.cpp:228</a></div></div>
<div class="ttc" id="aclassi2cMaster_html_a9d56b4ea47659456f19cff59ac96d5f9"><div class="ttname"><a href="classi2cMaster.html#a9d56b4ea47659456f19cff59ac96d5f9">i2cMaster::read</a></div><div class="ttdeci">bool read(uint8_t slaveAddr, uint8_t regAddr, uint8_t numOfBytes, uint8_t *data)</div><div class="ttdoc">sets up I2C connection to device, reads a number of data bytes and closes the connection</div><div class="ttdef"><b>Definition:</b> <a href="i2cMaster_8cpp_source.html#l00061">i2cMaster.cpp:61</a></div></div>
<div class="ttc" id="astructdropinCliSettings__t_html"><div class="ttname"><a href="structdropinCliSettings__t.html">dropinCliSettings_t</a></div><div class="ttdoc">Struct to store dropin settings.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00154">uStepperSLite.h:155</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_a479c3f88c98766f1df30eea67b907c6f"><div class="ttname"><a href="classuStepperEncoder.html#a479c3f88c98766f1df30eea67b907c6f">uStepperEncoder::oldAngle</a></div><div class="ttdeci">volatile uint16_t oldAngle</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00316">uStepperSLite.h:316</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a1d1ce82b808fe8bb9ee71f91e9fae009"><div class="ttname"><a href="classuStepperSLite.html#a1d1ce82b808fe8bb9ee71f91e9fae009">uStepperSLite::invertPidDropinDirection</a></div><div class="ttdeci">bool invertPidDropinDirection</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00636">uStepperSLite.h:636</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a539b0579a291bb4b3c6f4d3680db237f"><div class="ttname"><a href="classuStepperSLite.html#a539b0579a291bb4b3c6f4d3680db237f">uStepperSLite::stepConversion</a></div><div class="ttdeci">volatile float stepConversion</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00501">uStepperSLite.h:501</a></div></div>
<div class="ttc" id="aclassTmc2208_html_a325a92257b38336e9ef6df12fcd4d552"><div class="ttname"><a href="classTmc2208.html#a325a92257b38336e9ef6df12fcd4d552">Tmc2208::setup</a></div><div class="ttdeci">void setup(void)</div><div class="ttdoc">Initializes the different parts of the TMC2208 object.</div><div class="ttdef"><b>Definition:</b> <a href="TMC2208_8cpp_source.html#l00114">TMC2208.cpp:114</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a6ac76703b3b02956d2da43e3bc38e879"><div class="ttname"><a href="classuStepperSLite.html#a6ac76703b3b02956d2da43e3bc38e879">uStepperSLite::dropinPrintHelp</a></div><div class="ttdeci">void dropinPrintHelp()</div><div class="ttdoc">This method is used to print the dropinCli menu explainer:</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01991">uStepperSLite.cpp:1991</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_ae493894449c4fb212c6d09f9bcdd5278"><div class="ttname"><a href="classuStepperSLite.html#ae493894449c4fb212c6d09f9bcdd5278">uStepperSLite::enableMotor</a></div><div class="ttdeci">void enableMotor(void)</div><div class="ttdoc">Enables the stepper driver output stage.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01138">uStepperSLite.cpp:1138</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a06ea99f74b92b86a9ee098a31bef6c08"><div class="ttname"><a href="classuStepperSLite.html#a06ea99f74b92b86a9ee098a31bef6c08">uStepperSLite::stallSensitivity</a></div><div class="ttdeci">float stallSensitivity</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00520">uStepperSLite.h:520</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_afd708364388d62b61f32755868540e59"><div class="ttname"><a href="classuStepperSLite.html#afd708364388d62b61f32755868540e59">uStepperSLite::pTerm</a></div><div class="ttdeci">float pTerm</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00505">uStepperSLite.h:505</a></div></div>
<div class="ttc" id="astructdropinCliSettings__t_html_a00ded376c02dfc7d764f07d4ed8b47fd"><div class="ttname"><a href="structdropinCliSettings__t.html#a00ded376c02dfc7d764f07d4ed8b47fd">dropinCliSettings_t::D</a></div><div class="ttdeci">floatBytes_t D</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00158">uStepperSLite.h:158</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a8ec5937f21fa55da7c702c9e0a98ffda"><div class="ttname"><a href="classuStepperSLite.html#a8ec5937f21fa55da7c702c9e0a98ffda">uStepperSLite::targetPosition</a></div><div class="ttdeci">volatile int32_t targetPosition</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00558">uStepperSLite.h:558</a></div></div>
<div class="ttc" id="aclassi2cMaster_html_af639b1fb501c7530afdca5e87a56168f"><div class="ttname"><a href="classi2cMaster.html#af639b1fb501c7530afdca5e87a56168f">i2cMaster::begin</a></div><div class="ttdeci">void begin(void)</div><div class="ttdoc">Setup TWI (I2C) interface.</div><div class="ttdef"><b>Definition:</b> <a href="i2cMaster_8cpp_source.html#l00221">i2cMaster.cpp:221</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a0383041fd93699cb06f857e8680ddf73"><div class="ttname"><a href="classuStepperSLite.html#a0383041fd93699cb06f857e8680ddf73">uStepperSLite::pidError</a></div><div class="ttdeci">volatile uint8_t pidError</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00468">uStepperSLite.h:468</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a1fb1e84c8ba80795604e61c41fceee79"><div class="ttname"><a href="classuStepperSLite.html#a1fb1e84c8ba80795604e61c41fceee79">uStepperSLite::stepDelay</a></div><div class="ttdeci">volatile uint32_t stepDelay</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00453">uStepperSLite.h:453</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_aaf8a4bd9baac5f7370a33bbf439983ad"><div class="ttname"><a href="classuStepperSLite.html#aaf8a4bd9baac5f7370a33bbf439983ad">uStepperSLite::stepGeneratorDirection</a></div><div class="ttdeci">volatile uint8_t stepGeneratorDirection</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00456">uStepperSLite.h:456</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a22487ca5f5a944459268e29cdb800c2c"><div class="ttname"><a href="classuStepperSLite.html#a22487ca5f5a944459268e29cdb800c2c">uStepperSLite::continous</a></div><div class="ttdeci">bool continous</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00465">uStepperSLite.h:465</a></div></div>
<div class="ttc" id="aclassTmc2208_html_a357f3feef7327c7c12cb6af33466e4ce"><div class="ttname"><a href="classTmc2208.html#a357f3feef7327c7c12cb6af33466e4ce">Tmc2208::setHoldCurrent</a></div><div class="ttdeci">void setHoldCurrent(uint8_t holdPercent)</div><div class="ttdoc">Change hold current setting of the stepper motor driver - TMC2208.</div><div class="ttdef"><b>Definition:</b> <a href="TMC2208_8cpp_source.html#l00215">TMC2208.cpp:215</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_abf760d7949e75977bf11bce48256283c"><div class="ttname"><a href="classuStepperEncoder.html#abf760d7949e75977bf11bce48256283c">uStepperEncoder::getAngle</a></div><div class="ttdeci">float getAngle(void)</div><div class="ttdoc">Measure the current shaft angle.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00469">uStepperSLite.cpp:469</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a7cdcebc3e378c9aa5a849e75616bfb81"><div class="ttname"><a href="classuStepperSLite.html#a7cdcebc3e378c9aa5a849e75616bfb81">uStepperSLite::dropinSettingsCalcChecksum</a></div><div class="ttdeci">uint8_t dropinSettingsCalcChecksum(dropinCliSettings_t *settings)</div><div class="ttdoc">This method is used internally for stall detection.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l02037">uStepperSLite.cpp:2037</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a12aadc19a70c86840ffb8ae4fc52d757"><div class="ttname"><a href="classuStepperSLite.html#a12aadc19a70c86840ffb8ae4fc52d757">uStepperSLite::RPMToStepDelay</a></div><div class="ttdeci">volatile float RPMToStepDelay</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00536">uStepperSLite.h:536</a></div></div>
<div class="ttc" id="aclassi2cMaster_html_a20091cd125f847e2cf50d0c7373adaa0"><div class="ttname"><a href="classi2cMaster.html#a20091cd125f847e2cf50d0c7373adaa0">i2cMaster::getStatus</a></div><div class="ttdeci">uint8_t getStatus(void)</div><div class="ttdoc">Get current I2C status.</div><div class="ttdef"><b>Definition:</b> <a href="i2cMaster_8cpp_source.html#l00216">i2cMaster.cpp:216</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a276ca3c9c340cc55fa0e098cbbf1f7c3"><div class="ttname"><a href="classuStepperSLite.html#a276ca3c9c340cc55fa0e098cbbf1f7c3">uStepperSLite::setDifferential</a></div><div class="ttdeci">void setDifferential(float D)</div><div class="ttdoc">This method is used to change the PID differential parameter D.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01549">uStepperSLite.cpp:1549</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a4897e083f3220382b42cc77b393bdff9"><div class="ttname"><a href="classuStepperSLite.html#a4897e083f3220382b42cc77b393bdff9">uStepperSLite::driver</a></div><div class="ttdeci">Tmc2208 driver</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00631">uStepperSLite.h:631</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a68872d29c8b0dd78742faff9578e320d"><div class="ttname"><a href="classuStepperSLite.html#a68872d29c8b0dd78742faff9578e320d">uStepperSLite::brake</a></div><div class="ttdeci">bool brake</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00564">uStepperSLite.h:564</a></div></div>
<div class="ttc" id="astructdropinCliSettings__t_html_ab360463f25b89cd8192d284a6024c237"><div class="ttname"><a href="structdropinCliSettings__t.html#ab360463f25b89cd8192d284a6024c237">dropinCliSettings_t::checksum</a></div><div class="ttdeci">uint8_t checksum</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00162">uStepperSLite.h:162</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a1aa954540615bd51a5e2c2ba291e7016"><div class="ttname"><a href="classuStepperSLite.html#a1aa954540615bd51a5e2c2ba291e7016">uStepperSLite::enablePid</a></div><div class="ttdeci">void enablePid(void)</div><div class="ttdoc">This method enables the PID after being disabled (disablePid).</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01411">uStepperSLite.cpp:1411</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a936581f459eb80191ad1fd7feb092c08"><div class="ttname"><a href="classuStepperSLite.html#a936581f459eb80191ad1fd7feb092c08">uStepperSLite::setMaxAcceleration</a></div><div class="ttdeci">void setMaxAcceleration(float accel)</div><div class="ttdoc">Set the maximum acceleration of the stepper motor.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00534">uStepperSLite.cpp:534</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a702f67e1e3675882cb3a0c8d885d0567"><div class="ttname"><a href="classuStepperSLite.html#a702f67e1e3675882cb3a0c8d885d0567">uStepperSLite::moveAngle</a></div><div class="ttdeci">void moveAngle(float angle, bool holdMode=BRAKEON)</div><div class="ttdoc">Moves the motor to a relative angle.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01241">uStepperSLite.cpp:1241</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a48701518d855251f020d6da81507a5eb"><div class="ttname"><a href="classuStepperSLite.html#a48701518d855251f020d6da81507a5eb">uStepperSLite::currentPidSpeed</a></div><div class="ttdeci">volatile float currentPidSpeed</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00549">uStepperSLite.h:549</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_afc2f4ad942520df8dcc6aa20180c5197"><div class="ttname"><a href="classuStepperSLite.html#afc2f4ad942520df8dcc6aa20180c5197">uStepperSLite::getPidError</a></div><div class="ttdeci">float getPidError(void)</div><div class="ttdoc">This method returns the current PID error.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01422">uStepperSLite.cpp:1422</a></div></div>
<div class="ttc" id="aclassTmc2208_html_af81bbf175de574f64f3f49f91a822705"><div class="ttname"><a href="classTmc2208.html#af81bbf175de574f64f3f49f91a822705">Tmc2208::disableDriver</a></div><div class="ttdeci">void disableDriver(void)</div><div class="ttdoc">Disable the stepper motor driver - TMC2208.</div><div class="ttdef"><b>Definition:</b> <a href="TMC2208_8cpp_source.html#l00155">TMC2208.cpp:155</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_a29117f4952ff99ba53b90b842f4e69f1"><div class="ttname"><a href="classuStepperEncoder.html#a29117f4952ff99ba53b90b842f4e69f1">uStepperEncoder::getAngleMoved</a></div><div class="ttdeci">float getAngleMoved(void)</div><div class="ttdoc">Measure the angle moved from reference position.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00424">uStepperSLite.cpp:424</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_a72ec6da0a88627a1abe6380a65b84be4"><div class="ttname"><a href="classuStepperEncoder.html#a72ec6da0a88627a1abe6380a65b84be4">uStepperEncoder::getSpeed</a></div><div class="ttdeci">float getSpeed(bool unit=SPS)</div><div class="ttdoc">Measure the current speed of the motor.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00429">uStepperSLite.cpp:429</a></div></div>
<div class="ttc" id="aunionfloatBytes__t_html_ab5e9521b40211bb42fa6bdf349b51869"><div class="ttname"><a href="unionfloatBytes__t.html#ab5e9521b40211bb42fa6bdf349b51869">floatBytes_t::f</a></div><div class="ttdeci">float f</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00142">uStepperSLite.h:142</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a7720d4c23b591803b56d4610fdf04c1b"><div class="ttname"><a href="classuStepperSLite.html#a7720d4c23b591803b56d4610fdf04c1b">uStepperSLite::decelToAccelThreshold</a></div><div class="ttdeci">volatile int32_t decelToAccelThreshold</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00540">uStepperSLite.h:540</a></div></div>
<div class="ttc" id="astructdropinCliSettings__t_html_a5746cba668768ac204a54751bc932271"><div class="ttname"><a href="structdropinCliSettings__t.html#a5746cba668768ac204a54751bc932271">dropinCliSettings_t::invert</a></div><div class="ttdeci">uint8_t invert</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00159">uStepperSLite.h:159</a></div></div>
<div class="ttc" id="aclassTmc2208_html_a648e00eda3d756b154a7d62572d5c12d"><div class="ttname"><a href="classTmc2208.html#a648e00eda3d756b154a7d62572d5c12d">Tmc2208::enableDriver</a></div><div class="ttdeci">void enableDriver(void)</div><div class="ttdoc">Enable the stepper motor driver - TMC2208.</div><div class="ttdef"><b>Definition:</b> <a href="TMC2208_8cpp_source.html#l00150">TMC2208.cpp:150</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a833a6e3a84ee1ed1b6a1ec974d59ba2f"><div class="ttname"><a href="classuStepperSLite.html#a833a6e3a84ee1ed1b6a1ec974d59ba2f">uStepperSLite::detectStall</a></div><div class="ttdeci">bool detectStall(void)</div><div class="ttdoc">This method is used internally for stall detection.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01485">uStepperSLite.cpp:1485</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_ae0833b2d44aeb4987cbf3ce734911185"><div class="ttname"><a href="classuStepperSLite.html#ae0833b2d44aeb4987cbf3ce734911185">uStepperSLite::stop</a></div><div class="ttdeci">void stop(bool brake=BRAKEON)</div><div class="ttdoc">Stop the motor with deceleration.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00898">uStepperSLite.cpp:898</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_adeed207c50c8650d22dea4034bcdd587"><div class="ttname"><a href="classuStepperSLite.html#adeed207c50c8650d22dea4034bcdd587">uStepperSLite::getMotorState</a></div><div class="ttdeci">uint8_t getMotorState(void)</div><div class="ttdoc">Get the current state of the motor.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01153">uStepperSLite.cpp:1153</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a9522d6afb14f71c6034ece6537180e00"><div class="ttname"><a href="classuStepperSLite.html#a9522d6afb14f71c6034ece6537180e00">uStepperSLite::getCurrentDirection</a></div><div class="ttdeci">bool getCurrentDirection(void)</div><div class="ttdoc">Returns the direction the motor is currently configured to rotate.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01148">uStepperSLite.cpp:1148</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a7957fc7bbaf231a20ad4dc2b5506672b"><div class="ttname"><a href="classuStepperSLite.html#a7957fc7bbaf231a20ad4dc2b5506672b">uStepperSLite::state</a></div><div class="ttdeci">volatile uint8_t state</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00473">uStepperSLite.h:473</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a09da30650e441262d015907686107799"><div class="ttname"><a href="classuStepperSLite.html#a09da30650e441262d015907686107799">uStepperSLite::hardStop</a></div><div class="ttdeci">void hardStop(bool holdMode=BRAKEON)</div><div class="ttdoc">Stop the motor without deceleration.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00873">uStepperSLite.cpp:873</a></div></div>
<div class="ttc" id="astructdropinCliSettings__t_html_aa3341deb156fc6151de8794e43459732"><div class="ttname"><a href="structdropinCliSettings__t.html#aa3341deb156fc6151de8794e43459732">dropinCliSettings_t::I</a></div><div class="ttdeci">floatBytes_t I</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00157">uStepperSLite.h:157</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_afd5ccf623308a2f47af9b58ff2e16023"><div class="ttname"><a href="classuStepperSLite.html#afd5ccf623308a2f47af9b58ff2e16023">uStepperSLite::angleToStep</a></div><div class="ttdeci">float angleToStep</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00524">uStepperSLite.h:524</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_afe0647659291c6ed4f4104e95f5ae047"><div class="ttname"><a href="classuStepperEncoder.html#afe0647659291c6ed4f4104e95f5ae047">uStepperEncoder::curSpeed</a></div><div class="ttdeci">volatile float curSpeed</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00324">uStepperSLite.h:324</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a87ea117d2b589e26fa66db9927a7d0d6"><div class="ttname"><a href="classuStepperSLite.html#a87ea117d2b589e26fa66db9927a7d0d6">uStepperSLite::moveToEnd</a></div><div class="ttdeci">float moveToEnd(bool dir, float stallSensitivity=0.992)</div><div class="ttdoc">Moves the motor to its physical limit, without limit switch.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01184">uStepperSLite.cpp:1184</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_a990203acc3069947412e0a9dd36bc988"><div class="ttname"><a href="classuStepperEncoder.html#a990203acc3069947412e0a9dd36bc988">uStepperEncoder::detectMagnet</a></div><div class="ttdeci">uint8_t detectMagnet(void)</div><div class="ttdoc">Detect if magnet is present and within range.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00494">uStepperSLite.cpp:494</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a70343aa0d8b1379f718e757e6c17df4d"><div class="ttname"><a href="classuStepperSLite.html#a70343aa0d8b1379f718e757e6c17df4d">uStepperSLite::mode</a></div><div class="ttdeci">uint8_t mode</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00477">uStepperSLite.h:477</a></div></div>
<div class="ttc" id="astructdropinCliSettings__t_html_a447e69fba3c710086e68b7659bd919d7"><div class="ttname"><a href="structdropinCliSettings__t.html#a447e69fba3c710086e68b7659bd919d7">dropinCliSettings_t::holdCurrent</a></div><div class="ttdeci">uint8_t holdCurrent</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00160">uStepperSLite.h:160</a></div></div>
<div class="ttc" id="aclassTmc2208_html_af06fd0ce5ab19d219c30cb10dd5d69b7"><div class="ttname"><a href="classTmc2208.html#af06fd0ce5ab19d219c30cb10dd5d69b7">Tmc2208::setRunCurrent</a></div><div class="ttdeci">void setRunCurrent(uint8_t runPercent)</div><div class="ttdoc">Change run current setting of the stepper motor driver - TMC2208.</div><div class="ttdef"><b>Definition:</b> <a href="TMC2208_8cpp_source.html#l00202">TMC2208.cpp:202</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_ab9c80a99fca938eeb490e4ed8d109f04"><div class="ttname"><a href="classuStepperEncoder.html#ab9c80a99fca938eeb490e4ed8d109f04">uStepperEncoder::uStepperEncoder</a></div><div class="ttdeci">uStepperEncoder(void)</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00419">uStepperSLite.cpp:419</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a157fb9075d4c6c451a7f8e43367df27a"><div class="ttname"><a href="classuStepperSLite.html#a157fb9075d4c6c451a7f8e43367df27a">uStepperSLite::iTerm</a></div><div class="ttdeci">float iTerm</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00514">uStepperSLite.h:514</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a6aeca80444771d28fcd3e76b2c81b59a"><div class="ttname"><a href="classuStepperSLite.html#a6aeca80444771d28fcd3e76b2c81b59a">uStepperSLite::setIntegral</a></div><div class="ttdeci">void setIntegral(float I)</div><div class="ttdoc">This method is used to change the PID integral parameter I.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01544">uStepperSLite.cpp:1544</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a2c225c30565d8afc6472db1682ec0f78"><div class="ttname"><a href="classuStepperSLite.html#a2c225c30565d8afc6472db1682ec0f78">uStepperSLite::checkConnectorOrientation</a></div><div class="ttdeci">void checkConnectorOrientation(uint8_t mode)</div><div class="ttdoc">This method handles the connector orientation check in order to automatically compensate the PID for ...</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00949">uStepperSLite.cpp:949</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a2ff9d7a4e9145a9753dbb8d3ffc7f424"><div class="ttname"><a href="classuStepperSLite.html#a2ff9d7a4e9145a9753dbb8d3ffc7f424">uStepperSLite::direction</a></div><div class="ttdeci">volatile uint8_t direction</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00484">uStepperSLite.h:484</a></div></div>
<div class="ttc" id="astructdropinCliSettings__t_html_ac36b9ae1990fb507c66fda2bacee5bf9"><div class="ttname"><a href="structdropinCliSettings__t.html#ac36b9ae1990fb507c66fda2bacee5bf9">dropinCliSettings_t::runCurrent</a></div><div class="ttdeci">uint8_t runCurrent</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00161">uStepperSLite.h:161</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a8780cb16590ff36482bb5b3a3392298b"><div class="ttname"><a href="classuStepperSLite.html#a8780cb16590ff36482bb5b3a3392298b">uStepperSLite::stepCnt</a></div><div class="ttdeci">volatile int32_t stepCnt</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00481">uStepperSLite.h:481</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a2573e7e23d167d45682543c8993ab9f2"><div class="ttname"><a href="classuStepperSLite.html#a2573e7e23d167d45682543c8993ab9f2">uStepperSLite::currentPidError</a></div><div class="ttdeci">volatile float currentPidError</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00620">uStepperSLite.h:620</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a41d04fb191c2799613aa8fe810712152"><div class="ttname"><a href="classuStepperSLite.html#a41d04fb191c2799613aa8fe810712152">uStepperSLite::setProportional</a></div><div class="ttdeci">void setProportional(float P)</div><div class="ttdoc">This method is used to change the PID proportional parameter P.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01539">uStepperSLite.cpp:1539</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_a6d391ceaf50957f3d1ae8736a4c60d76"><div class="ttname"><a href="classuStepperEncoder.html#a6d391ceaf50957f3d1ae8736a4c60d76">uStepperEncoder::setup</a></div><div class="ttdeci">void setup(void)</div><div class="ttdoc">Setup the encoder.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00441">uStepperSLite.cpp:441</a></div></div>
<div class="ttc" id="aclassi2cMaster_html"><div class="ttname"><a href="classi2cMaster.html">i2cMaster</a></div><div class="ttdoc">Prototype of class for accessing the TWI (I2C) interface of the AVR (master mode only).</div><div class="ttdef"><b>Definition:</b> <a href="i2cMaster_8h_source.html#l00093">i2cMaster.h:94</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_ada5b6ce856fea6afe4d7491da3fe8677"><div class="ttname"><a href="classuStepperSLite.html#ada5b6ce856fea6afe4d7491da3fe8677">uStepperSLite::loadDropinSettings</a></div><div class="ttdeci">bool loadDropinSettings(void)</div><div class="ttdoc">This method loads the dropin settings stored in EEPROM.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l02010">uStepperSLite.cpp:2010</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_af64de6cee4e18b4ad23e4382b9218a2e"><div class="ttname"><a href="classuStepperSLite.html#af64de6cee4e18b4ad23e4382b9218a2e">uStepperSLite::getStepsSinceReset</a></div><div class="ttdeci">int32_t getStepsSinceReset(void)</div><div class="ttdoc">Get the number of steps applied since reset.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01163">uStepperSLite.cpp:1163</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a1f52578e510fe01d10bb464d84133395"><div class="ttname"><a href="classuStepperSLite.html#a1f52578e510fe01d10bb464d84133395">uStepperSLite::pidDropin</a></div><div class="ttdeci">void pidDropin(float error)</div><div class="ttdoc">This method handles the actual PID Drop-in controller calculations, if enabled.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01427">uStepperSLite.cpp:1427</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a78bfc1598d8eb68a024cda81c6e6efc4"><div class="ttname"><a href="classuStepperSLite.html#a78bfc1598d8eb68a024cda81c6e6efc4">uStepperSLite::setHoldCurrent</a></div><div class="ttdeci">void setHoldCurrent(uint8_t holdCurrent)</div><div class="ttdoc">Set motor hold current.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01173">uStepperSLite.cpp:1173</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_abf3fc82540c092e8a6c68d4580bedbf9"><div class="ttname"><a href="classuStepperEncoder.html#abf3fc82540c092e8a6c68d4580bedbf9">uStepperEncoder::setHome</a></div><div class="ttdeci">void setHome(void)</div><div class="ttdoc">Define new reference(home) position.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00451">uStepperSLite.cpp:451</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_aa1acc67d587fdf8b686a0209d5a008c0"><div class="ttname"><a href="classuStepperSLite.html#aa1acc67d587fdf8b686a0209d5a008c0">uStepperSLite::pid</a></div><div class="ttdeci">void pid(float error)</div><div class="ttdoc">This method handles the actual PID controller calculations, if enabled.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01257">uStepperSLite.cpp:1257</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a1b876adeb71ec6f0f03dba8bb88df30c"><div class="ttname"><a href="classuStepperSLite.html#a1b876adeb71ec6f0f03dba8bb88df30c">uStepperSLite::moveSteps</a></div><div class="ttdeci">void moveSteps(int32_t steps, bool dir, bool holdMode=BRAKEON)</div><div class="ttdoc">Make the motor perform a predefined number of steps.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00682">uStepperSLite.cpp:682</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_ad9e7aea31c689237a0e20650516596e5"><div class="ttname"><a href="classuStepperSLite.html#ad9e7aea31c689237a0e20650516596e5">uStepperSLite::decelToStopThreshold</a></div><div class="ttdeci">volatile int32_t decelToStopThreshold</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00460">uStepperSLite.h:460</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_acd6d73628d5caa20a63e01c0e6327488"><div class="ttname"><a href="classuStepperSLite.html#acd6d73628d5caa20a63e01c0e6327488">uStepperSLite::setRunCurrent</a></div><div class="ttdeci">void setRunCurrent(uint8_t runCurrent)</div><div class="ttdoc">Set motor run current.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01178">uStepperSLite.cpp:1178</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a16ab4c0524815f984e1b12e423414f76"><div class="ttname"><a href="classuStepperSLite.html#a16ab4c0524815f984e1b12e423414f76">uStepperSLite::dropinSettings</a></div><div class="ttdeci">dropinCliSettings_t dropinSettings</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l01037">uStepperSLite.h:1037</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a5324ae9b6cfbb63a1b82433c7c2b77a1"><div class="ttname"><a href="classuStepperSLite.html#a5324ae9b6cfbb63a1b82433c7c2b77a1">uStepperSLite::dTerm</a></div><div class="ttdeci">float dTerm</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00517">uStepperSLite.h:517</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_a8a4a9e8dab1412c67de52b4454050d3e"><div class="ttname"><a href="classuStepperEncoder.html#a8a4a9e8dab1412c67de52b4454050d3e">uStepperEncoder::getAgc</a></div><div class="ttdeci">uint8_t getAgc(void)</div><div class="ttdoc">Read the current AGC value of the encoder chip.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00485">uStepperSLite.cpp:485</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_a26b81725b7a995fed98de0fcdd614b1f"><div class="ttname"><a href="classuStepperEncoder.html#a26b81725b7a995fed98de0fcdd614b1f">uStepperEncoder::getStrength</a></div><div class="ttdeci">uint16_t getStrength(void)</div><div class="ttdoc">Measure the strength of the magnet.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00474">uStepperSLite.cpp:474</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a8963700f7f2fcbdc2ffc3efa1e16f117"><div class="ttname"><a href="classuStepperSLite.html#a8963700f7f2fcbdc2ffc3efa1e16f117">uStepperSLite::stepsSinceReset</a></div><div class="ttdeci">volatile int32_t stepsSinceReset</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00446">uStepperSLite.h:446</a></div></div>
<div class="ttc" id="aclassuStepperEncoder_html_a602c25ed26a1d3b48ba2215a40b0edd8"><div class="ttname"><a href="classuStepperEncoder.html#a602c25ed26a1d3b48ba2215a40b0edd8">uStepperEncoder::encoderOffset</a></div><div class="ttdeci">uint16_t encoderOffset</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00311">uStepperSLite.h:311</a></div></div>
<div class="ttc" id="aclassuStepperServo_html_ab5df754d288da28c01ab6feac6dce6b4"><div class="ttname"><a href="classuStepperServo.html#ab5df754d288da28c01ab6feac6dce6b4">uStepperServo::angle</a></div><div class="ttdeci">uint8_t angle</div><div class="ttdef"><b>Definition:</b> <a href="uStepperServo_8h_source.html#l00050">uStepperServo.h:50</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a1eb46f8626f7ddd7e4f7f8d301fced50"><div class="ttname"><a href="classuStepperSLite.html#a1eb46f8626f7ddd7e4f7f8d301fced50">uStepperSLite::setMaxVelocity</a></div><div class="ttdeci">void setMaxVelocity(float vel)</div><div class="ttdoc">Sets the maximum rotational velocity of the motor.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00551">uStepperSLite.cpp:551</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a522818baa29b655181ab43d6ece90cff"><div class="ttname"><a href="classuStepperSLite.html#a522818baa29b655181ab43d6ece90cff">uStepperSLite::setup</a></div><div class="ttdeci">void setup(uint8_t mode=NORMAL, float stepsPerRevolution=3200.0, float pTerm=0.75, float iTerm=3.0, float dTerm=0.0, bool setHome=true, uint8_t invert=0, uint8_t runCurrent=50, uint8_t holdCurrent=30)</div><div class="ttdoc">Initializes the different parts of the uStepper S-lite object.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01020">uStepperSLite.cpp:1020</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_aa8dc00944af9823735619ede4e114439"><div class="ttname"><a href="classuStepperSLite.html#aa8dc00944af9823735619ede4e114439">uStepperSLite::uStepperSLite</a></div><div class="ttdeci">uStepperSLite(float accel=1000.0, float vel=1000.0)</div><div class="ttdoc">Constructor of uStepper S-lite class.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00520">uStepperSLite.cpp:520</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a54011dd2ecd8b93d6037f603a2af320c"><div class="ttname"><a href="classuStepperSLite.html#a54011dd2ecd8b93d6037f603a2af320c">uStepperSLite::parseCommand</a></div><div class="ttdeci">void parseCommand(String *cmd)</div><div class="ttdoc">This method is used for the dropinCli to take in user commands.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01559">uStepperSLite.cpp:1559</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a3d1c21d80071e805998750ea55e7b8f9"><div class="ttname"><a href="classuStepperSLite.html#a3d1c21d80071e805998750ea55e7b8f9">uStepperSLite::softStop</a></div><div class="ttdeci">void softStop(bool holdMode=BRAKEON)</div><div class="ttdoc">Stop the motor with deceleration.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l00903">uStepperSLite.cpp:903</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_aa3d8c0808aa478933e47cde6ccd4f1f6"><div class="ttname"><a href="classuStepperSLite.html#aa3d8c0808aa478933e47cde6ccd4f1f6">uStepperSLite::stall</a></div><div class="ttdeci">volatile bool stall</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00532">uStepperSLite.h:532</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a823c0099863617f8bb4b61ea1a4d1775"><div class="ttname"><a href="classuStepperSLite.html#a823c0099863617f8bb4b61ea1a4d1775">uStepperSLite::disablePid</a></div><div class="ttdeci">void disablePid(void)</div><div class="ttdoc">This method disables the PID until calling enablePid.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01406">uStepperSLite.cpp:1406</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a10d7a7ee710c5cf58e0c80d0ce2d3a09"><div class="ttname"><a href="classuStepperSLite.html#a10d7a7ee710c5cf58e0c80d0ce2d3a09">uStepperSLite::moveToAngle</a></div><div class="ttdeci">void moveToAngle(float angle, bool holdMode=BRAKEON)</div><div class="ttdoc">Moves the motor to an absolute angle.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01223">uStepperSLite.cpp:1223</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a4bad2987e56031e2bf18b4bb49641312"><div class="ttname"><a href="classuStepperSLite.html#a4bad2987e56031e2bf18b4bb49641312">uStepperSLite::saveDropinSettings</a></div><div class="ttdeci">void saveDropinSettings(void)</div><div class="ttdoc">This method stores the current dropin settings in EEPROM.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l02030">uStepperSLite.cpp:2030</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_acbf77fec7a15ae675a19045f2f500ba9"><div class="ttname"><a href="classuStepperSLite.html#acbf77fec7a15ae675a19045f2f500ba9">uStepperSLite::dropinCli</a></div><div class="ttdeci">void dropinCli()</div><div class="ttdoc">This method is used to tune Drop-in parameters. After tuning uStepper S-lite the parameters are saved...</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01965">uStepperSLite.cpp:1965</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_ab6b5281894496ce93b304f8af3ef812c"><div class="ttname"><a href="classuStepperSLite.html#ab6b5281894496ce93b304f8af3ef812c">uStepperSLite::stepToAngle</a></div><div class="ttdeci">float stepToAngle</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00528">uStepperSLite.h:528</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_ab0895bb46175c172b902d23d6dbe7daa"><div class="ttname"><a href="classuStepperSLite.html#ab0895bb46175c172b902d23d6dbe7daa">uStepperSLite::setCurrent</a></div><div class="ttdeci">void setCurrent(uint8_t runCurrent, uint8_t holdCurrent=25)</div><div class="ttdoc">Set motor run and hold current.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01168">uStepperSLite.cpp:1168</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a1432dae31727fbfbed1a303262499f17"><div class="ttname"><a href="classuStepperSLite.html#a1432dae31727fbfbed1a303262499f17">uStepperSLite::disableMotor</a></div><div class="ttdeci">void disableMotor(void)</div><div class="ttdoc">Disables the stepper driver output stage.</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8cpp_source.html#l01143">uStepperSLite.cpp:1143</a></div></div>
<div class="ttc" id="aclassuStepperSLite_html_a5abaa99d3ef37f17f3382e30519e2473"><div class="ttname"><a href="classuStepperSLite.html#a5abaa99d3ef37f17f3382e30519e2473">uStepperSLite::pidTargetPosition</a></div><div class="ttdeci">volatile float pidTargetPosition</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00625">uStepperSLite.h:625</a></div></div>
<div class="ttc" id="auStepperSLite_8cpp_html_a3a756c7227d10234519040a63ba256b4"><div class="ttname"><a href="uStepperSLite_8cpp.html#a3a756c7227d10234519040a63ba256b4">I2C</a></div><div class="ttdeci">i2cMaster I2C(1)</div></div>
<div class="ttc" id="aclassuStepperSLite_html_afef8bec3d96458ee9d079df69283d8e3"><div class="ttname"><a href="classuStepperSLite.html#afef8bec3d96458ee9d079df69283d8e3">uStepperSLite::pidDisabled</a></div><div class="ttdeci">volatile bool pidDisabled</div><div class="ttdef"><b>Definition:</b> <a href="uStepperSLite_8h_source.html#l00561">uStepperSLite.h:561</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 14 2020 14:01:45 for uStepper S-lite by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
